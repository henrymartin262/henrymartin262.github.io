<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="henry">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2024/08/10/envfuzz/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="论文链接：https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2404.13951  代码链接：https:&#x2F;&#x2F;github.com&#x2F;GJDuck&#x2F;EnvFuzz  看论文 Program Environment Fuzzing1 INTRODUCTION原有的基于灰盒的模糊器都受限于 fuzz 特定的输入源，如（AFL、AFL++、AFLNet 等等），但是 envfuzz 将程序所有的输入都看做可以用">
<meta property="og:type" content="article">
<meta property="og:title" content="看论文 Program Environment Fuzzing">
<meta property="og:url" content="http://example.com/2024/08/10/envFuzz/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="论文链接：https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2404.13951  代码链接：https:&#x2F;&#x2F;github.com&#x2F;GJDuck&#x2F;EnvFuzz  看论文 Program Environment Fuzzing1 INTRODUCTION原有的基于灰盒的模糊器都受限于 fuzz 特定的输入源，如（AFL、AFL++、AFLNet 等等），但是 envfuzz 将程序所有的输入都看做可以用">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-09_15-39-20.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-09_16-25-51.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-09_21-31-12.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-09_22-08-37.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-09_22-27-06.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-09_22-08-37.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-10_20-04-24.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-10_20-27-17.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-10_00-09-45.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-10_00-20-20.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-08-10_14-31-22.png">
<meta property="article:published_time" content="2024-08-10T13:14:47.281Z">
<meta property="article:modified_time" content="2024-08-21T01:40:25.700Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="fuzz">
<meta property="article:tag" content="envfuzz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/Snipaste_2024-08-09_15-39-20.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/icon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/icon.png">
    <!--- Page Info-->
    
    <title>
        
            看论文 Program Environment Fuzzing -
        
        Henry Martin
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-we3z86.webp","dark":"/images/wallhaven-6degr6.webp"},"title":"Welcome To Henry's Blog","subtitle":{"text":["a pwner from polaris"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/henrymartin262","instagram":"https://instagram.com","zhihu":"https://www.zhihu.com/","twitter":"https://twitter.com","email":"1551022913@qq.cmo"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":true,"type":"fixed","audios":[{"name":"Something Just Like This","artist":"Coldplay","url":"https://evan.beee.top/music/Something%20Just%20Like%20This%20-%20The%20Chainsmokers%E3%80%81Coldplay.mp3","cover":"https://evan.beee.top/music/covers/Something_Just_Like_This.png"}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.6","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories/","icon":"fa-regular fa-folder"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Links":"/links/","Github":"https://github.com/henrymartin262","Blog":"https://henrymartin262.github.io"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2023/11/24 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            $logo-title-font-size = 1.7rem
$desktop-search-icon-font-size = 1.5rem
$navbar-bar-line-height = 2.5px
$logo-image-box-width = 34px

@import '../../common/variables'

.navbar-container
  font-family 'Chillax-Variable', sans-serif
  width 100%
  height 100%
  box-sizing border-box
  display flex
  align-items center
  justify-content center
  background $nav-color-bg
  -webkit-backdrop-filter blur(10px)
  backdrop-filter blur(10px)
  padding-top $scroll-progress-bar-height
  hover-style(
    false,
    0,
    0
  )

  .navbar-content
    position relative
    height 100%
    width $main-content-width
    max-width $content-max-width
    display flex
    flex-direction row
    justify-content space-between
    align-items center
    z-index $z-index-5
    transition max-width 0.3s ease

    &.has-home-banner
      max-width $content-max-width * 1.2

    +redefine-tablet()
      width $main-content-width-tablet

    +redefine-mobile()
      width $main-content-width-mobile

    .left
      display flex
      align-items center
      //transform-origin bottom
      //transition-t('transform', '0', '0.15', 'ease')
      //
      //.navbar-shrink &
      //  transform scale(0.9)
      //  transform-origin bottom

      if (hexo-config('defaults.logo') && hexo-config('defaults.logo') != '')
        .logo-image
          width $logo-image-box-width
          height $logo-image-box-width
          margin-right 12px

          +redefine-tablet()
            width: $logo-image-box-width * 0.9
            height: $logo-image-box-width * 0.9

          +redefine-mobile()
            width: $logo-image-box-width * 0.8
            height: $logo-image-box-width * 0.8

          img
            border-radius 6px
            width 100%

      .logo-title
        font-size $logo-title-font-size
        font-weight 520
        //letter-spacing 1px
        line-height 1
        color var(--first-text-color)
        transform translateY(1px)

        h1
          margin 0
          font-size $logo-title-font-size
          font-weight 520
          //letter-spacing 1px
          line-height 1
          color var(--first-text-color)
          transform translateY(1px)

          +redefine-tablet()
            font-size: $logo-title-font-size * 0.9

          +redefine-mobile()
            font-size: $logo-title-font-size * 0.8

        +redefine-tablet()
          font-size: $logo-title-font-size * 0.9

        +redefine-mobile()
          font-size: $logo-title-font-size * 0.8

    .right
      .desktop
        .navbar-list
          display flex
          gap 24px
          align-items center

          +redefine-tablet()
            display none

          .navbar-item
            float left
            // padding 5px
            position relative
            font-size 1rem
            font-weight 450
            cursor pointer
            color var(--default-text-color)

            a
              display block
              padding 5px

            a .fa-chevron-down
              transform rotate(0deg)
              transition transform 0.3s ease

            &:hover a .fa-chevron-down
              transform rotate(180deg)

            &:hover .has-dropdown
              &::after
                display none !important

            &:hover a, .active
              &::after
                content ''
                position absolute
                bottom -5px
                left 50%
                width 100%
                height 2px
                transform translateX(-50%)
                border-radius $redefine-border-radius-large
                background var(--primary-color)
                transition-t('transform, bottom', '0, 0', '0.2, 0.2', 'linear, linear')

                .navbar-shrink &
                  bottom -($navbar-shrink-height / 2 - 17)

            &.search
              font-size $desktop-search-icon-font-size
              margin-left 26px

              i
                color var(--default-text-color)

            .sub-menu
              position absolute
              right auto
              left 50%
              -webkit-transform translate(-50%, 0)
              -o-transform translate(-50%, 0)
              transform translate(-50%, 0)
              margin-top 0px
              width auto
              text-align center
              list-style none
              padding 0 10px
              border-radius $redefine-border-radius-large
              // visibility hidden
              max-height 0px
              overflow hidden
              transition-t('all', '0', '0.2', 'linear')

              li a
                white-space nowrap
                color var(--default-text-color)
                font-size 1rem
                padding 3px 15px
                display block
                text-align center
                border-radius 8px
                transition-t('all', '0', '0.2', 'linear')

                &:hover
                  color var(--primary-color)
                  background-color var(--third-background-color)

        .navbar-list .navbar-item:hover .sub-menu
          // visibility visible
          max-height 500px
          transition-t('all', '0', '0.2', 'ease')
          redefine-container(
            false,
            0,
            0,
            10px,
            5px
          )

      .mobile
        display flex
        justify-content space-between
        align-items center

        .icon-item
          display none
          position relative
          cursor pointer
          font-size 18px
          margin-left 12px
          width 20px
          height 20px
          color var(--default-text-color)

          i
            color var(--default-text-color)

          &:first-child
            margin-left 0

          +redefine-tablet()
            display flex
            justify-content center
            align-items center

        .navbar-bar
          .navbar-bar-middle
            width 18px
            height $navbar-bar-line-height
            position relative
            background var(--default-text-color)

            .navbar-drawer-show &
              background transparent

            &::before, &::after
              content ''
              position absolute
              left 0
              width 100%
              height $navbar-bar-line-height
              background var(--default-text-color)
              transition-t('transform', '0', '0.38', 'ease')

            &::before
              top -6px

              .navbar-drawer-show &
                transform translateY(6px) rotate(45deg)

            &::after
              bottom -6px

              .navbar-drawer-show &
                transform translateY(-6px) rotate(-45deg)

  .navbar-drawer
    padding $navbar-height 0 20px 0
    transform scaleY(0)
    transform-origin top
    z-index $z-index-2
    opacity 0
    max-height 100vh
    overflow-y auto
    transition-t('transform,opacity', '0,0.1', '0.38,0.38', 'ease,ease')

    .navbar-drawer-show &
      transform scaleY(1)
      opacity 1

  .window-mask
    position absolute
    top 0
    width 100%
    height 100vh
    background rgba(0, 0, 0, 0.4)
    z-index $z-index-1
    visibility hidden
    opacity 0
    transition-t('transform, opacity', '0, 0', '0.38, 0.38', 'ease, ease')

    .navbar-drawer-show &
      visibility visible
      opacity 1

.navbar-drawer-show
  overflow hidden

        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="/images/Snipaste_2024-08-10_21-16-46.png" alt="看论文 Program Environment Fuzzing" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-start">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-bold backdrop-blur-lg rounded-xl border border-border-color ">看论文 Program Environment Fuzzing</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/henry.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">henry</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-08-10 21:14:47</span>
        <span class="mobile">2024-08-10 21:14:47</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-08-21 09:40:25</span>
            <span class="mobile">2024-08-21 09:40:25</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/fuzz/">fuzz</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/fuzz/paper/">paper</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/fuzz/">fuzz</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/envfuzz/">envfuzz</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <p>论文链接：<a class="link" target="_blank" rel="noopener" href="https://arxiv.org/pdf/2404.13951">https://arxiv.org/pdf/2404.13951 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>代码链接：<a class="link" target="_blank" rel="noopener" href="https://github.com/GJDuck/EnvFuzz">https://github.com/GJDuck/EnvFuzz <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="看论文-Program-Environment-Fuzzing"><a href="#看论文-Program-Environment-Fuzzing" class="headerlink" title="看论文 Program Environment Fuzzing"></a>看论文 Program Environment Fuzzing</h1><h2 id="1-INTRODUCTION"><a href="#1-INTRODUCTION" class="headerlink" title="1 INTRODUCTION"></a>1 INTRODUCTION</h2><p>原有的基于灰盒的模糊器都受限于 fuzz 特定的输入源，如（AFL、AFL++、AFLNet 等等），但是 envfuzz 将程序所有的输入都看做可以用来进行 fuzz 的目标（后面会解释）。</p>
<p>目标：网络协议，linux 下 GUI 程序</p>
<p><strong>总结：</strong></p>
<ul>
<li>envFuzz 采用了一种新的方法去捕获程序环境</li>
<li>基于在用户内核交互层提出了一个算法用于<strong>回放和记录</strong></li>
<li>envFuzz 是一种通用模糊器，可以用来测试各种程序类型（linux）</li>
</ul>
<h2 id="2-BACKGROUND-AND-MOTIVATION"><a href="#2-BACKGROUND-AND-MOTIVATION" class="headerlink" title="2 BACKGROUND AND MOTIVATION"></a>2 BACKGROUND AND MOTIVATION</h2><p>现有的 fuzzer 大都在生成变异输入的时候，不考虑所有的输入，而仅仅针对某一特定的输入类。比如说，AFL 只针对标准输入或命令行指定的文件。AFLnet 只针对特定协议的端口上的网络传输。</p>
<p><strong>传统 fuzzer 的工作流程：</strong></p>
<ul>
<li><strong>输入选择：</strong>哪一个输入应该作为 fuzz 的对象</li>
<li><strong>环境建模：</strong>如何处理其他输入</li>
</ul>
<p><strong>envFuzz 的核心思想：</strong></p>
<ul>
<li>所有的环境输入都是可以被 fuzz 的</li>
<li>环境建模：避免复杂繁琐的建模过程，而是通过变异系统调用来捕获对程序环境的影响</li>
</ul>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-09_15-39-20.png" alt="对nipaste_2024-08-09_15-39-2"></p>
<p>以这个linux下的 GNOME 计算器来进行说明，其在使用情况下，需要各种外部环境资源，而在 envFUZZ 中对上图 a 中所有的外部资源的输入，作为了 fuzz 的对象。</p>
<p>作者所采用的方法是记录（record）所有的环境交互，这个交互可以理解为是系统调用层的环境交互。然后在根据前面记录的交互信息开始迭代重放（replay），只不过在这一步的过程中，有一个重要思想就是会对先前的交互的部分信息进行变异。</p>
<h2 id="3-SYSTEM-OVERVIEW"><a href="#3-SYSTEM-OVERVIEW" class="headerlink" title="3 SYSTEM OVERVIEW"></a>3 SYSTEM OVERVIEW</h2><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-09_16-25-51.png" alt="nipaste_2024-08-09_16-25-5"></p>
<p>以上面这个图为例子进行说明 envFuzz 的工作流，前面有提到 envFuzz 的工作流程主要分为两个阶段：</p>
<p>（1）record</p>
<p>envFuzz 将会拦截程序 p 在运行过程中产生的所有系统调用，并作为记录保存在𝜎 = [𝐸1, 𝐸2, 𝐸3, 𝐸4] 中，这些信息将会被用在第二个阶段。这些信息具体包括，系统调用号，系统调用参数，缓冲区内容和返回值等等，其实就是将这些信息用来作为第二个阶段的初始种子。</p>
<p>（2）replay</p>
<p>这一阶段又包含两个方面：	</p>
<ul>
<li>先通过前面记录的环境交互信息 𝜎，重放以建立第一个阶段中一样的程序状态；</li>
<li>使用灰盒测试的方法 fuzz 每一个<strong>重建的状态</strong></li>
</ul>
<p>不同于 AFL 或者 AFLnet fuzz 某一个特定的标准输入/文件或者是一个特定的套接字，envFuzz 的 fuzz 目标是所有记录下来的环境交互状态，replay 的流程大概为：从语料库选出测试的种子S，然后通过变异生成一个新的环境交互。可以简单理解为从系统调用层面进行变异，可以是参数的变化，系统调用顺序的变化，甚至是变异出一个新的系统调用来观察程序的行为。对于一些比较有用的变异将会保存到语料库用于后期进一步利用。</p>
<h2 id="4-ENVIRONMENT-FUZZING"><a href="#4-ENVIRONMENT-FUZZING" class="headerlink" title="4 ENVIRONMENT FUZZING"></a>4 ENVIRONMENT FUZZING</h2><h3 id="4-1-Environment-Recording-and-Replay"><a href="#4-1-Environment-Recording-and-Replay" class="headerlink" title="4.1 Environment Recording and Replay"></a>4.1 Environment Recording and Replay</h3><p><strong>首先对于 record 阶段</strong>，作者实现了一个系统调用拦截例程。当程序触发一个系统调用时，首先会被该例程所拦截，例程会对当前系统调用的信息进行记录，随后将会该系统调用转发给内核，并等待返回结果，再将返回结果也进行记录，然后再返回给程序。这个过层就称为<strong>一次 interaction</strong>，用 <strong>E</strong> 来表示，<strong>E 具体所包含的信息有</strong>：</p>
<ul>
<li>系统调用号（如 read，write）</li>
<li>参数信息（文件描述符，缓冲区指针和缓冲区大小）</li>
<li>缓冲区内容</li>
<li>当前线程 ID</li>
<li>返回值</li>
</ul>
<p><strong>其次对于 replay 阶段，</strong>这一阶段首先会将先前的 record E 信息进行重放，也就是把上面阶段中记录的系统调用进行复现操作，但是 replay 并不会完全重复相同的操作，而是会基于 record 进行一次或多次的变异来观察程序的行为。</p>
<p>作者举了一个例子用来说明其过程，比如说程序 P 执行了一个系统调用 <code>read(0, buf, 100)</code>，然后用户输入<code>"quit\n"</code>，返回值为 5。这一系统调用过程首先将会被拦截器所拦截，然后记作 record E，在 replay 阶段 envfuzz 可能会将 buf 的内容变异为 <code>"quip\n"</code>，在发送给内核，以便发现新的程序行为。</p>
<p>通过上面这一简单的例子，可以大致明白 envfuzz 工作的原理。</p>
<h3 id="4-2-Reflections-on-Search-Challenges"><a href="#4-2-Reflections-on-Search-Challenges" class="headerlink" title="4.2 Reflections on Search Challenges"></a>4.2 Reflections on Search Challenges</h3><p>再具体实现时，需要考虑到两个挑战因素：</p>
<ul>
<li>无状态：如何有效的深度探索程序行为</li>
<li>吞吐量：如何保证 fuzz 拥有高吞吐量</li>
</ul>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-09_21-31-12.png" alt="nipaste_2024-08-09_21-31-1"></p>
<p><strong>（1）无状态</strong></p>
<p>为了说明第一个挑战，这里以上图为例进行说明，上图左边部分可以看做是一个 GUI 计算器程序执行过程中主要的几个系统调用（实际可能伴随着成百上千的系统调用），程序从一个 <code>INIT</code> 状态开始，首先通过 <code>read(0)</code> 解析配置文件的位置，其次通过 <code>send(3)</code> 向窗口系统套接字发送消息创建一个 GUI 界面。然后进入到 <code>READY</code> 状态，等待接受用户输入的数学表达式 <code>recv(3)</code>，然后通过 <code>send(3)</code> 将计算出来的结果返回给界面，这时进入到 <code>DISPLAY</code> 状态，最后用户关闭界面 <code>recv(3)</code>，程序进入到 <code>CLOSING</code> 状态，这里程序在退出前发送一条消息给终端然后退出。</p>
<p>可以发现在系统调用层面，程序是有状态的，通过执行一系列系统调用可以让程序从一个状态进入到另外一个状态，这也就意味着我们在 fuzz 有状态的程序时，不能够盲目的 fuzz，而是需要考虑这种状态的识别，以上图为例，不然可能都不能进入到 <code>DISPLAY</code> 一些深层次的程序行为。</p>
<p>基于程序状态识别这块，现有的研究基本上要么建立在需要人工去设置一些操作，要么专门用于特定的输入，那么因为 envFuzz 它是一个 generic 的东西，所以论文中对于状态识别所采用的方法是：每发生一次输入系统调用时，就认为其发生了一次状态转换，还是以上面的图为例子，可以发现在每一次经过 <code>recv()</code> 之后程序的状态就会发生一次改变。</p>
<p><strong>注意事项：</strong>需要理解的是为什么要重视这种状态转换，原因就在于每一次状态的变化，就可能意味着产生新的程序行为，从而也就可能产生新的 bug。</p>
<p><strong>当然，作者这里也只是假定认为在发生类似输入类型的系统调用时，程序状态发生改变，实际上还是在有些情况下，程序状态并不会发生改变。</strong>对于这种情况，envFuzz 所采用的手段是在未来的变异中降低优先级。</p>
<p><strong>（2）吞吐量</strong></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-09_22-08-37.png" alt="nipaste_2024-08-09_22-08-3"></p>
<p>还是拿出这张图来进行说明，为了能够有效的提高吞吐量，不让在 fuzz 某一个特定状态时，重复执行前面的系统调用，论文中采用了这种鱼骨式的 fuzz 策略，简单来说，当检测到存在 <code>recv</code> 这类系统调用时，fuzzer 会 fork 出来新进程，并对系统调用进行变异，从而尝试产生新的行为（也就是上图中分叉红色的部分），当这些 fork 出来的子进程全部都执行结束时，再回到原来正确地方，也就是路径 0，进入 <code>send(3)</code>，然后在遇到下一个 <code>recv</code> 操作时，在重复前面的行为，直到最后执行到路径 0 的 <code>exit</code> 操作。</p>
<p>不得不说，这种方法在 fuzz GUI 程序时，确实是一个不错的思想，<strong>因为被 fuzz 的程序是有一条主干路径的，也就是说在 fuzz 的过程中，fuzzer 不会盲目进行  fuzz，而是会保证一直沿着这个状态顺序尽可能 fuzz 到每一个输入点</strong>。</p>
<p>当然这也给了我们使用 envFuzz 时的一些思想，可以<strong>在 record 阶段尽可能多的去触发一些新的如上图的主干路径，也会在很大程度上提高 fuzz 的效率</strong>。</p>
<h3 id="4-3-Fuzzing-Search-Algorithm"><a href="#4-3-Fuzzing-Search-Algorithm" class="headerlink" title="4.3 Fuzzing Search Algorithm"></a>4.3 Fuzzing Search Algorithm</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-09_22-27-06.png" alt="nipaste_2024-08-09_22-27-0"></p>
<p>上图为 envFuzz 实现的一个核心算法，其实通过前面部分的描述，这个算法其实我们还是可以直接看懂的。需要注意的是 14 行，每当在 spine（前面提到的路径 0） 上检测到一个非输入系统调用，就会原样重复该系统调用，但是只要是输入系统调用，就会进入到 for 循环，envfuzz 将会从语料库 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.797ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1236.2 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(646,-150) scale(0.707)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g></g></g></g></svg></mjx-container>中，取出一个种子 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.472ex" height="1.717ex" role="img" focusable="false" viewBox="0 -759 1092.8 759"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mo" transform="translate(848.3,363) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g></g></g></svg></mjx-container>，然后变异生成 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.912ex" height="1.717ex" role="img" focusable="false" viewBox="0 -759 1287.2 759"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mo" transform="translate(848.3,363) scale(0.707)"><g data-c="2033"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z" transform="translate(275,0)"></path></g></g></g></g></g></svg></mjx-container>，接着 fork 出来一个子进程，子进程将会进入到 19,20 行，设置 <strong>isBranch <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.181ex" role="img" focusable="false" viewBox="0 -511 1000 522"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="2190" d="M944 261T944 250T929 230H165Q167 228 182 216T211 189T244 152T277 96T303 25Q308 7 308 0Q308 -11 288 -11Q281 -11 278 -11T272 -7T267 2T263 21Q245 94 195 151T73 236Q58 242 55 247Q55 254 59 257T73 264Q121 283 158 314T215 375T247 434T264 480L267 497Q269 503 270 505T275 509T288 511Q308 511 308 500Q308 493 303 475Q293 438 278 406T246 352T215 315T185 287T165 270H929Q944 261 944 250Z"></path></g></g></g></svg></mjx-container> true</strong>，随后继续通过 <code>ReplaySyscall</code> 来生成新的执行路径（branch）。</p>
<blockquote>
<p><strong>注意事项：</strong>可以看到父进程在等待子进程结束后，会根据状态 status 来判断子进程的状态，从而来判断子进程是 crash，还是这个种子 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.912ex" height="1.717ex" role="img" focusable="false" viewBox="0 -759 1287.2 759"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mo" transform="translate(848.3,363) scale(0.707)"><g data-c="2033"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z" transform="translate(275,0)"></path></g></g></g></g></g></svg></mjx-container> 是不是 Interesting 的，简而言之就是说这个种子是否能够产生新的路径等有效的行为，从而将其加入到语料库，用于后期的 fuzz</p>
</blockquote>
<h3 id="4-4-Fuzzing-Feedback"><a href="#4-4-Fuzzing-Feedback" class="headerlink" title="4.4 Fuzzing Feedback"></a>4.4 Fuzzing Feedback</h3><p>通过变异后的路径反馈信息，可以判断一个种子是否是有效的，大多数 fuzzer（afl-gcc） 是通过编译插桩的形式来得到路径反馈信息，但由于这里我们是灰盒测试，为了达到一个更通用的效果，论文中采用了 <a class="link" target="_blank" rel="noopener" href="https://github.com/GJDuck/e9afl">E9AFL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，可以使用静态二进制重写将检测工具直接插入二进制代码中。</p>
<p>当然对于有状态程序，仅仅有分支覆盖被认为是不够的，为了判断一个种子是不是 interesting，我们还需要获取它的状态信息，但是前面也有提到，分析程序状态是一个比较有挑战性的任务（现有的研究，没有好的办法去解决），所以说作者这里采用了另外一种方法，就是在每一次执行完输入调用后，检测其输出以判断是否发生状态转换。这是因为在输入变化后，在一定程度上会伴随着输出的改变（这么一想也确实有点道理）。</p>
<h2 id="5-RELAXED-REPLAY-FOR-DIVERGENCE"><a href="#5-RELAXED-REPLAY-FOR-DIVERGENCE" class="headerlink" title="5 RELAXED REPLAY FOR DIVERGENCE"></a>5 RELAXED REPLAY FOR DIVERGENCE</h2><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-09_22-08-37.png" alt="nipaste_2024-08-09_22-08-3"></p>
<p>细心地同学可能会发现，前面的算法在第 10 行如果判断 isBranch 为真，就会进入 <code>EmulateSyscall</code> 函数，而这一部分就是来讨论这个函数的实现，还是在来通过上面这张图来理解，在通过变异一个输入系统调用后，其后的程序状态可能会发生一些改变，这时候我们需要决定后续需要执行哪些操作，因为这时候程序状态改变，依靠重放原有的系统调用可能会失效，<strong>具体来说就是</strong>：</p>
<ul>
<li><p>在记录阶段，Efuzz框架会构建一个按<strong>顺序的记录序列（𝜎）</strong>，例如 𝜎 = [𝜎1, 𝐸, 𝜎2]，其中 𝐸 是一个输入。</p>
</li>
<li><p>在模糊测试阶段，Efuzz首先重放前缀 𝜎1（作为主干的一部分），然后<strong>突变 𝐸 生成一个或多个突变体 𝐸′</strong>。接下来，<strong>用 𝐸′ 替换 𝐸 进行重放</strong>。</p>
</li>
<li><p>重放 𝐸′ 后，<strong>原本的后缀 𝜎2 可能无法继续重放，因为程序行为已经发生了偏离</strong>。这就意味着突变后的序列 𝜎′ = [𝜎1, 𝐸′, 𝜎2] 可能无法实现。</p>
</li>
</ul>
<p>所以这里使用另一种方法来处理这种情况。作者这里引入的方法是 <code>relaxed replay</code>，<strong>核心思想</strong>是使用系统调用仿真去建立分叉后的执行路径。具体的方法就是，为每一个系统调用创建一个<strong>仿真例程</strong>，每一个例程将会接受系统调用参数，并且返回一个结果。同时，这些例程是可以被随时调用的。</p>
<h3 id="5-1-Relaxing-I-O-System-Call-Ordering"><a href="#5-1-Relaxing-I-O-System-Call-Ordering" class="headerlink" title="5.1 Relaxing I/O System Call Ordering"></a>5.1 Relaxing I/O System Call Ordering</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-10_20-04-24.png" alt="nipaste_2024-08-10_20-04-2"></p>
<p>文中介绍了一种通过 <code>miniqueue </code>来解决前面提出的在变异后后续的重放问题，如上图所示，<strong>miniqueue</strong>: 这个方法将记录序列 𝜎 分成若干个 “miniqueues”（小队列），每个小队列与一个特定的I/O源（即文件描述符 <code>fd</code>）对应。例如，一个文件描述符对应一个队列，管理与该描述符相关的系统调用。</p>
<p>上面的图中，在原始的全局顺序（𝜎）下，只有来自文件描述符0的读取系统调用可以被服务。但在突变之后，程序可能会尝试在不同的文件描述符上进行I/O操作。为处理这种情况，这种方法允许根据每个 <code>fd</code> 的局部顺序，而不是原始的全局顺序（𝜎），直接从对应的 <code>miniqueue</code> 处理I/O系统调用。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-10_20-27-17.png" alt="nipaste_2024-08-10_20-27-1"></p>
<p>对于程序来说，使用poll call来查询当前可用的 I/O操作数量也是很常见的，<code>relaxed replay</code> 必须使用仿真处理轮询系统调用。该算法如算法2所示，是仿真例程的具体示例。<code>EmulatePoll</code> 算法模拟了 <code>poll</code> 系统调用，通过遍历<strong>每个文件描述符的操作队列</strong>，检查<strong>是否有可以立即执行的I/O操作</strong>。如果检测到可以执行的操作，则返回检测到的数量；如果没有检测到可执行操作，算法<strong>通过重新排序操作队列来避免阻塞</strong>，并继续尝试检测。这个过程确保了即使在模拟环境中，也能尽可能模拟真实的I/O操作行为。</p>
<p>对于I/O调用，特别是输入和输出的顺序变化，系统通过模拟<code>poll</code>操作和适应突变后生成的额外输出来处理。而对于非I/O调用，系统通过模拟、传递、失败和退出等策略来处理不同类型的系统调用，以确保测试的继续进行并避免程序进入死循环。</p>
<h2 id="6-IMPLEMENTATION"><a href="#6-IMPLEMENTATION" class="headerlink" title="6 IMPLEMENTATION"></a>6 IMPLEMENTATION</h2><p>envfuzz 由 c++ 代码完成，总共大概有 13k 的代码量</p>
<p>在 record 阶段<strong>，记录所有必要的信息，如系统调用（主要部分），命令行参数，环境变量，信号，线程交错（thread interleavings），特殊的非确定性指令。为了拦截系统调用，框架采用了多种技术。通常的做法是使用静态二进制重写（static binary rewriting）技术，</strong>重写C库（libc）中的系统调用指令，将控制流引导到框架的拦截器例程中。这是通过使用E9Patch二进制重写系统来实现的<strong>。框架还会在运行时重写虚拟动态共享对象（vDSO），并使用seccomp机制生成信号（SIGSYS），以拦截C库外部的系统调用（这种情况较为少见）</strong>。没有使用ptrace机制，因此避免了在重放期间进行内核模式和用户模式之间的切换，从而优化了常见情况下的性能。</p>
<p><strong>多线程程序处理</strong></p>
<p><strong>序列化系统调用（Serializing System Calls）</strong></p>
<ul>
<li><strong>记录阶段</strong>：在程序的记录阶段，所有的系统调用都是按序列化的方式处理的。这意味着在记录阶段，程序中的多个线程不会同时运行，而是一个线程执行完毕后，另一个线程再运行。这样做是为了简化线程调度，确保系统调用的顺序是一致的且可以被正确记录。</li>
</ul>
<p><strong>纤程（Fibers）的使用</strong>：</p>
<ul>
<li><strong>重放与模糊测试阶段</strong>：在重放和模糊测试阶段，<code>Envfuzz</code> 使用了轻量级的“纤程”（fibers）来代替系统线程。纤程是一种纯用户态实现的执行线程，其上下文切换由记录的调度（<code>𝜎</code>）来决定。这种设计绕过了传统 <code>fork()</code> 调用中的一个主要技术限制：在 <code>fork()</code> 操作中，只有调用 <code>fork()</code> 的那个系统线程会被实际克隆，而其他线程不会被克隆。</li>
<li><strong>纤程的优势</strong>：纤程与系统线程的不同之处在于，它们完全在用户态中实现，没有用户态与内核态的交互。因此，在重放阶段，纤程可以直接替代系统线程，并且不需要特殊处理。此外，由于纤程是在用户态中实现的，它们不会受到 <code>fork()</code> 操作的影响，能完整地保留 <code>fork()</code> 之前的状态，这对 <code>Envfuzz</code> 的模糊测试算法是至关重要的</li>
</ul>
<p><strong>envFuzz 设计与反馈机制</strong></p>
<p><strong>直接作用于二进制文件：</strong></p>
<ul>
<li><code>Efuzz</code> 被设计为可以直接在二进制文件上运行，而不需要源代码。这样可以使得 <code>Envfuzz</code> 适用于更多的应用程序，而不受编程语言或开发环境的限制。</li>
</ul>
<p><strong>状态与分支覆盖作为反馈：</strong></p>
<ul>
<li><strong>状态覆盖</strong>：在模糊测试过程中，<code>Envfuzz</code> 使用状态覆盖（state coverage）作为反馈机制。这种反馈不需要对二进制文件进行额外的插桩操作。</li>
<li><strong>分支覆盖</strong>：分支覆盖（branch coverage）是另一个重要的反馈机制，用于检测程序在不同输入下走过的分支路径。为了收集分支覆盖的反馈信息，<code>Efuzz</code> 可以使用经过修改的 E9AFL 工具对二进制文件进行插桩（instrumentation）。</li>
</ul>
<p><strong>支持大型应用程序：</strong></p>
<ul>
<li><code>Envfuzz</code> 的实现可以记录和模糊测试大型应用程序，这表明它在实际环境中具有良好的适用性和可扩展性。</li>
</ul>
<h2 id="7-EVALUATION"><a href="#7-EVALUATION" class="headerlink" title="7 EVALUATION"></a>7 EVALUATION</h2><h3 id="7-1-Experiment-Setup"><a href="#7-1-Experiment-Setup" class="headerlink" title="7.1 Experiment Setup"></a>7.1 Experiment Setup</h3><p><strong>Subject Programs</strong></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-10_00-09-45.png" alt="nipaste_2024-08-10_00-09-4"></p>
<p>envFuzz 测试的程序主要分为两类，一类是左边的基于网络协议的程序；另外一类是右边的基于GUI的程序。对于左边程序检测 envfuzz 发现 bug 的性能，可以使用 ProFuzzBench 作为 baseline 测试。然后对于 GUI 程序几乎没有 fuzz 测试集，所以作者这里选出了几类比较知名的 linux 下的 GUI 程序。</p>
<p><strong>Comparisons</strong></p>
<p>对于网络协议，这里将	AFLnet 和 NYX-NET 作为 baseline 进行比较。</p>
<p>对于GUI程序，无。</p>
<p><strong>Performance Metrics</strong></p>
<p>评价 envfuzz 的性能指标，分别为 <strong>（1）bug 发现能力；（2）路径覆盖率</strong>，其中将第一个作为主要因素来考量 envfuzz 的性能。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-10_00-20-20.png" alt="nipaste_2024-08-10_00-20-2"></p>
<p>上图即为 envFuzz 最后实际检测出来的漏洞，每一个程序项目在 24 小时内完成，可以发现 envfuzz 还是非常强大的，笔者在自己机器跑的时候，也能在短时间内跑出较多的 crash。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-08-10_14-31-22.png" alt="nipaste_2024-08-10_14-31-2"></p>
<p>上图为 envfuzz 和 AFLnet，NYX-net 的统计数据，上图为24h内发现的 bug 数，下图为路径覆盖分支数，可以看到envfuzz的效果远远比另外两个 fuzzer 好。   </p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>等我用明白了再来….</p>

        </div>

        
            <div class="post-copyright-info my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> 看论文 Program Environment Fuzzing</li>
        <li><strong>Author:</strong> henry</li>
        <li><strong>Created at
                :</strong> 2024-08-10 21:14:47</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-08-21 09:40:25
            </li>
        
        <li>
            <strong>Link:</strong> https://henrymartin262.github.io/2024/08/10/envFuzz/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/fuzz/">#fuzz</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/envfuzz/">#envfuzz</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/08/23/6.0_Data_Flow_Analysis-Foundations_II/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">南大《软件分析》6.0 Data Flow Analysis - Foundations II</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/08/07/5.0_Data_Flow_Analysis-Foundations_I/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">南大《软件分析》5.0 Data Flow Analysis - Foundations I</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container pjax">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          requiredMeta: ['nick', 'mail']
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">看论文 Program Environment Fuzzing</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9C%8B%E8%AE%BA%E6%96%87-Program-Environment-Fuzzing"><span class="nav-text">看论文 Program Environment Fuzzing</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-INTRODUCTION"><span class="nav-text">1 INTRODUCTION</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-BACKGROUND-AND-MOTIVATION"><span class="nav-text">2 BACKGROUND AND MOTIVATION</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-SYSTEM-OVERVIEW"><span class="nav-text">3 SYSTEM OVERVIEW</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-ENVIRONMENT-FUZZING"><span class="nav-text">4 ENVIRONMENT FUZZING</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Environment-Recording-and-Replay"><span class="nav-text">4.1 Environment Recording and Replay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Reflections-on-Search-Challenges"><span class="nav-text">4.2 Reflections on Search Challenges</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Fuzzing-Search-Algorithm"><span class="nav-text">4.3 Fuzzing Search Algorithm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Fuzzing-Feedback"><span class="nav-text">4.4 Fuzzing Feedback</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-RELAXED-REPLAY-FOR-DIVERGENCE"><span class="nav-text">5 RELAXED REPLAY FOR DIVERGENCE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Relaxing-I-O-System-Call-Ordering"><span class="nav-text">5.1 Relaxing I&#x2F;O System Call Ordering</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-IMPLEMENTATION"><span class="nav-text">6 IMPLEMENTATION</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-EVALUATION"><span class="nav-text">7 EVALUATION</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Experiment-Setup"><span class="nav-text">7.1 Experiment Setup</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">henry</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.6</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


    <div id="aplayer"></div>

<script src="/js/libs/APlayer.min.js"></script>


<script src="/js/plugins/aplayer.js"></script>


</body>
</html>
