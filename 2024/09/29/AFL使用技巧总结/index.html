<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="henry">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2024/09/29/afl使用技巧总结/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="AFL 使用技巧总结快速简易上手 使用 afl-cc 编译项目或者库，比较常见的做法如下：  123CC&#x3D;afl-cc CXX&#x3D;afl-c++ .&#x2F;configure --disable-sharedcmake -DCMAKE_C_COMPILERC&#x3D;afl-cc -DCMAKE_CXX_COMPILER&#x3D;afl-c++ .CC&#x3D;afl-cc CXX&#x3D;afl-c++ meson   如果项目从 s">
<meta property="og:type" content="article">
<meta property="og:title" content="AFL 使用技巧总结">
<meta property="og:url" content="http://example.com/2024/09/29/AFL%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="AFL 使用技巧总结快速简易上手 使用 afl-cc 编译项目或者库，比较常见的做法如下：  123CC&#x3D;afl-cc CXX&#x3D;afl-c++ .&#x2F;configure --disable-sharedcmake -DCMAKE_C_COMPILERC&#x3D;afl-cc -DCMAKE_CXX_COMPILER&#x3D;afl-c++ .CC&#x3D;afl-cc CXX&#x3D;afl-c++ meson   如果项目从 s">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-09-24_10-57-52.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-09-24_11-00-16.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-09-24_11-02-32.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-09-24_11-10-27.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-09-24_11-11-47.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2024-09-24_22-53-06.png">
<meta property="article:published_time" content="2024-09-29T02:29:32.660Z">
<meta property="article:modified_time" content="2024-09-29T02:39:27.841Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="AFL++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/Snipaste_2024-09-24_10-57-52.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/icon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/icon.png">
    <!--- Page Info-->
    
    <title>
        
            AFL 使用技巧总结 -
        
        Henry Martin
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-we3z86.webp","dark":"/images/wallhaven-6degr6.webp"},"title":"Welcome To Henry's Blog","subtitle":{"text":["a pwner from polaris"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/henrymartin262","instagram":"https://instagram.com","zhihu":"https://www.zhihu.com/","twitter":"https://twitter.com","email":"1551022913@qq.cmo"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":true,"type":"fixed","audios":[{"name":"Something Just Like This","artist":"Coldplay","url":"https://evan.beee.top/music/Something%20Just%20Like%20This%20-%20The%20Chainsmokers%E3%80%81Coldplay.mp3","cover":"https://evan.beee.top/music/covers/Something_Just_Like_This.png"}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.6","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories/","icon":"fa-regular fa-folder"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Links":"/links/","Github":"https://github.com/henrymartin262","Blog":"https://henrymartin262.github.io"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2023/11/24 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Henry Martin
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories/"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fa-regular fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/links/">LINKS
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/henrymartin262">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://henrymartin262.github.io">BLOG
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories/"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/tags"  >
                             
                                
                                    <i class="fa-regular fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/links/">LINKS</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/henrymartin262">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://henrymartin262.github.io">BLOG</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="/images/Snipaste_2024-09-24_11-00-16.png" alt="AFL 使用技巧总结" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-start">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-bold backdrop-blur-lg rounded-xl border border-border-color ">AFL 使用技巧总结</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/henry.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">henry</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-09-29 10:29:32</span>
        <span class="mobile">2024-09-29 10:29:32</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-09-29 10:39:27</span>
            <span class="mobile">2024-09-29 10:39:27</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/fuzz/">fuzz</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/fuzz/AFL/">AFL++</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/AFL/">AFL++</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="AFL-使用技巧总结"><a href="#AFL-使用技巧总结" class="headerlink" title="AFL 使用技巧总结"></a>AFL 使用技巧总结</h1><h2 id="快速简易上手"><a href="#快速简易上手" class="headerlink" title="快速简易上手"></a>快速简易上手</h2><ol>
<li>使用 afl-cc 编译项目或者库，比较常见的做法如下：</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CC=afl-cc CXX=afl-c++ ./configure --disable-shared</span><br><span class="line">cmake -DCMAKE_C_COMPILERC=afl-cc -DCMAKE_CXX_COMPILER=afl-c++ .</span><br><span class="line">CC=afl-cc CXX=afl-c++ meson</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>如果项目从 stdin 读入，则 afl-fuzz 如下</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./afl-fuzz -i seeds_dir -o output_dir -- \</span><br><span class="line">/path/to/tested/program [...program's cmdline...]</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>如果程序从<strong>文件中获取输入</strong>，则可以在程序的命令行中放置@@，AFL++将在其中放置一个自动生成的文件名。</p>
</blockquote>
<ol start="3">
<li>可以从 output_dir 中找到输出的结果，如 crash 和 hangs，若程序直接是从 stdin 中读入的，则可以将 crash 的结果直接喂给程序，命令如下</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat output_dir/crashes/id:000000,* | /path/to/tested/program [...program's cmdline...]</span><br></pre></td></tr></table></figure></div>



<h2 id="源码模糊测试"><a href="#源码模糊测试" class="headerlink" title="源码模糊测试"></a>源码模糊测试</h2><p><a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/tree/stable/docs">参考文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>当有目标程序的源码时，在进行模糊测试时，一般遵循以下步骤</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-09-24_10-57-52.png" alt="nipaste_2024-09-24_10-57-5"></p>
<p>下面来分别说明每个部分具体工作</p>
<h3 id="Instrument-target"><a href="#Instrument-target" class="headerlink" title="Instrument target"></a>Instrument target</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-09-24_11-00-16.png" alt="nipaste_2024-09-24_11-00-1"></p>
<h3 id="Preparing-the-fuzzing-campaign"><a href="#Preparing-the-fuzzing-campaign" class="headerlink" title="Preparing the fuzzing campaign"></a>Preparing the fuzzing campaign</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-09-24_11-02-32.png" alt="nipaste_2024-09-24_11-02-3"></p>
<p>这里需要注意的是 afl-cmin 的作用是将冗余重复的文件删掉，而 afl-tmin 的作用是将文件本身的内容进行简化。</p>
<h3 id="Fuzzing-the-target"><a href="#Fuzzing-the-target" class="headerlink" title="Fuzzing the target"></a>Fuzzing the target</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-09-24_11-10-27.png" alt="nipaste_2024-09-24_11-10-2"></p>
<h3 id="Managing-the-fuzzing-campaign"><a href="#Managing-the-fuzzing-campaign" class="headerlink" title="Managing the fuzzing campaign"></a>Managing the fuzzing campaign</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-09-24_11-11-47.png" alt="nipaste_2024-09-24_11-11-4"></p>
<h2 id="2-fuzzing-in-depth"><a href="#2-fuzzing-in-depth" class="headerlink" title="2. fuzzing in depth"></a>2. fuzzing in depth</h2><h3 id="2-1-Instrumenting-the-target"><a href="#2-1-Instrumenting-the-target" class="headerlink" title="2.1 Instrumenting the target"></a>2.1 Instrumenting the target</h3><ol>
<li>选一个合适的编译器，用来对目标进行插桩，模式选择如下</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------+</span><br><span class="line">| clang/clang++ 11+ is available | --&gt; use LTO mode (afl-clang-lto/afl-clang-lto++)</span><br><span class="line">+--------------------------------+     see [instrumentation/README.lto.md](instrumentation/README.lto.md)</span><br><span class="line">    |</span><br><span class="line">    | if not, or if the target fails with LTO afl-clang-lto/++</span><br><span class="line">    |</span><br><span class="line">    v</span><br><span class="line">+---------------------------------+</span><br><span class="line">| clang/clang++ 3.8+ is available | --&gt; use LLVM mode (afl-clang-fast/afl-clang-fast++)</span><br><span class="line">+---------------------------------+     see [instrumentation/README.llvm.md](instrumentation/README.llvm.md)</span><br><span class="line">    |</span><br><span class="line">    | if not, or if the target fails with LLVM afl-clang-fast/++</span><br><span class="line">    |</span><br><span class="line">    v</span><br><span class="line"> +--------------------------------+</span><br><span class="line"> | gcc 5+ is available            | -&gt; use GCC_PLUGIN mode (afl-gcc-fast/afl-g++-fast)</span><br><span class="line"> +--------------------------------+    see [instrumentation/README.gcc_plugin.md](instrumentation/README.gcc_plugin.md) and</span><br><span class="line">                                       [instrumentation/README.instrument_list.md](instrumentation/README.instrument_list.md)</span><br><span class="line">    |</span><br><span class="line">    | if not, or if you do not have a gcc with plugin support</span><br><span class="line">    |</span><br><span class="line">    v</span><br><span class="line">   use GCC mode (afl-gcc/afl-g++) (or afl-clang/afl-clang++ for clang)</span><br></pre></td></tr></table></figure></div>

<p>LTO和GCC_PLUGIN通常提供更好的性能，而LLVM和GCC则适合更广泛的环境</p>
<p>可以通过以下方法之一选择 afl-cc 编译器的模式：</p>
<ul>
<li><p>使用符号链接到 afl-cc：afl-gcc、afl-g++、afl-clang、afl-clang++、afl-clang-fast、afl-clang-fast++、afl-clang-lto、afl-clang-lto++、afl-gcc-fast、afl-g++-fast（推荐！）。</p>
</li>
<li><p><code>AFL_CC_COMPILER</code>使用环境变量<code>MODE</code>。</p>
</li>
<li><p>将 –afl-<code>MODE</code>命令行选项传递给编译器。<code>CFLAGS</code>，<code>CXXFLAGS</code>，<code>CPPFLAGS</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export CFLAGS="--afl-MODE=xxx"</span><br><span class="line">export CXXFLAGS="--afl-MODE=xxx"</span><br></pre></td></tr></table></figure></div>


<p><code>MODE</code> 的值可以为如下：</p>
<ul>
<li>LTO (afl-clang-lto*)</li>
<li>LLVM (afl-clang-fast*)</li>
<li>GCC_PLUGIN (afl-g*-fast) or GCC (afl-gcc/afl-g++)</li>
<li>CLANG(afl-clang/afl-clang++)</li>
</ul>
</li>
</ul>
<h4 id="Selecting-sanitizers"><a href="#Selecting-sanitizers" class="headerlink" title="Selecting sanitizers"></a>Selecting sanitizers</h4><p>以下清理器在 AFL++ 中有内置支持：</p>
<ul>
<li>ASAN = Address SANitizer，查找内存损坏漏洞，如释放后使用、空指针取消引用、缓冲区溢出等。 <code>export AFL_USE_ASAN=1</code>编译前启用。</li>
<li>MSAN = Memory SANitizer，查找对未初始化内存的读取访问，例如在设置之前定义并读取的局部变量。 <code>export AFL_USE_MSAN=1</code>在编译之前启用。</li>
<li>UBSAN = 未定义行为 SANitizer，根据 C 和 C++ 标准，查找发生未定义行为的情况，例如，将两个有符号整数相加，结果大于有符号整数可以容纳的数。<code>export AFL_USE_UBSAN=1</code>编译前启用。</li>
<li>CFISAN = 控制流完整性 SANitizer，查找控制流非法的实例。最初，这是为了防止返回导向编程 (ROP) 漏洞链发挥作用。在模糊测试中，这主要是为了检测类型混淆漏洞 - 然而，这是最重要和最危险的 C++ 内存损坏类之一！<code>export AFL_USE_CFISAN=1</code>在编译之前启用。</li>
<li><code>export AFL_USE_TSAN=1</code>TSAN = Thread SANitizer，查找线程竞争条件。编译前启用。</li>
<li>LSAN = Leak SANitizer，用于查找程序中的内存泄漏。对于开发人员来说，这非常有价值。请注意，与上面的其他清理器不同，这需要<code>__AFL_LEAK_CHECK();</code>添加到发现需要泄漏检查的目标源代码的所有区域！在编译之前启用 <code>export AFL_USE_LSAN=1</code>。要<strong>忽略某些分配的内存泄漏检查</strong>，<code>__AFL_LSAN_OFF();</code>可以在分配内存之前和<code>__AFL_LSAN_ON();</code>之后使用。这两个宏之间分配的内存将不会检查内存泄漏。</li>
</ul>
<h4 id="Modifying-the-target"><a href="#Modifying-the-target" class="headerlink" title="Modifying the target"></a>Modifying the target</h4><p>当源代码中有存在类似计算校验和和哈希这种费时操作时，可以直接在源码中将它们删除，格式如下</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifdef FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION</span><br><span class="line">  // say that the checksum or HMAC was fine - or whatever is required</span><br><span class="line">  // to eliminate the need for the fuzzer to guess the right checksum</span><br><span class="line">  return 0;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></div>



<h4 id="Instrumenting-the-target"><a href="#Instrumenting-the-target" class="headerlink" title="Instrumenting the target"></a>Instrumenting the target</h4><p><strong>始终将想要检测的库编译为静态库，并将它们链接到目标程序</strong></p>
<p>配置选项</p>
<p>对于<code>configure</code>构建系统，这通常通过以下方式完成：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CC=afl-clang-fast CXX=afl-clang-fast++ ./configure --disable-shared</span><br></pre></td></tr></table></figure></div>



<p>对于 <code>CMake</code> 构建系统，这通常通过以下方式完成：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir build; cd build; cmake -DCMAKE_C_COMPILER=afl-cc -DCMAKE_CXX_COMPILER=afl-c++ ..</span><br></pre></td></tr></table></figure></div>



<p>对于 Meson Build System 使用下面的命令设置</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CC=afl-cc CXX=afl-c++ meson</span><br></pre></td></tr></table></figure></div>



<h4 id="Better-instrumentation"><a href="#Better-instrumentation" class="headerlink" title="Better instrumentation"></a>Better instrumentation</h4><p>如果只是按原样对目标程序进行模糊测试，在一定程度上是效率非常低下的。</p>
<p>为了让 fuzz 的速度更快，就需要所谓的<code>persistent mode</code>，这会让速度快得多，但需要编写一个源文件，该文件专门调用要模糊测试的目标函数，以及一些特定的 AFL++ 函数。详细信息可以见这里 <a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/instrumentation/README.persistent_mode.md">persistent mode <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 。</p>
<h3 id="2-2-Preparing-the-fuzzing-campaign"><a href="#2-2-Preparing-the-fuzzing-campaign" class="headerlink" title="2.2 Preparing the fuzzing campaign"></a>2.2 Preparing the fuzzing campaign</h3><p><strong>a) 收集输入</strong></p>
<p>其实就是语料库收集，官方这里给了一个 <a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/tree/stable/testcases">testcase <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 可以拿来用</p>
<p><strong>b）使输入语料库独一无二</strong></p>
<p>使用 AFL++ 工具<code>afl-cmin</code>从语料库中删除不会在目标中产生新路径/覆盖的输入：</p>
<ol>
<li><p><a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/fuzzing_in_depth.md#a-collecting-inputs">将步骤 a <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>中的所有文件放入一个目录中，例如 <code>INPUTS</code>。</p>
</li>
<li><p>运行 afl-cmin：</p>
<ul>
<li><p>如果目标程序要通过 fuzzing 调用<code>bin/target INPUTFILE</code>，则将目标程序读取的 INPUTFILE 参数替换为 <code>@@</code>：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-cmin -i INPUTS -o INPUTS_UNIQUE -- bin/target -someopt @@</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>如果目标从 stdin（标准输入）读取，则只需省略<code>@@</code> ，因为这是默认值：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-cmin -i INPUTS -o INPUTS_UNIQUE -- bin/target -someopt</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ol>
<p><strong>强烈建议执行此步骤</strong>，因为此后测试用例语料库不会再充斥着重复内容，从而减慢模糊测试的进度！</p>
<p><strong>c) 最小化所有语料库文件</strong></p>
<p>实际上就是在对原始文件缩小的情况下，仍然能够保持同样的覆盖效果，执行步骤如下</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir input</span><br><span class="line">cd INPUTS_UNIQUE</span><br><span class="line">for i in *; do</span><br><span class="line">  afl-tmin -i "$i" -o "../input/$i" -- bin/target -someopt @@</span><br><span class="line">done</span><br></pre></td></tr></table></figure></div>

<p>此步骤也可并行执行，例如使用<code>parallel</code>。</p>
<h2 id="3-Fuzzing-the-target"><a href="#3-Fuzzing-the-target" class="headerlink" title="3. Fuzzing the target"></a>3. Fuzzing the target</h2><h3 id="3-1-加快执行速度"><a href="#3-1-加快执行速度" class="headerlink" title="3.1 加快执行速度"></a>3.1 加快执行速度</h3><p>执行下面的两个命令，会使得 afl-fuzz 的速度得到增强，但是同时系统的防护能力也会减弱。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo afl-system-config</span><br><span class="line">sudo afl-persistent-config</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-必要时添加字典"><a href="#3-2-必要时添加字典" class="headerlink" title="3.2 必要时添加字典"></a>3.2 必要时添加字典</h3><p>添加词典的方式有如下操作：</p>
<ul>
<li>直接通过告诉 afl-fuzz 加载字典<code>-x dictionaries/FORMAT.dict</code>，这里给出了一些<a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/tree/stable/dictionaries">字典库 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。</li>
<li>在使用<code>afl-clang-lto</code>时，可以进行自动词典生成</li>
<li>在使用<code>afl-clang-fast</code>时， <code>AFL_LLVM_DICT2FILE=/full/path/to/new/file.dic</code> 这个设置可以在目标编译期间自动生成字典。添加<code>AFL_LLVM_DICT2FILE_NO_MAIN=1</code>不解析主函数（通常是命令行参数解析）通常也是可行的。</li>
<li>还可以在目标独立运行期间自己生成字典，请参阅 <a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/utils/libtokencap/README.md">utils/libtokencap/README.md <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。</li>
<li>最后，当然，也可以手动编写字典文件。</li>
</ul>
<h3 id="3-3-控制内存使用和超时"><a href="#3-3-控制内存使用和超时" class="headerlink" title="3.3 控制内存使用和超时"></a>3.3 控制内存使用和超时</h3><p>其实就是设置 <code>-m</code> 和 <code>-t</code> 两个参数，在默认情况下，afl-fuzz 不强制执行内存限制，系统可能会耗尽内存，所以可以<strong>使用 -m 减少内存分配</strong>。</p>
<p>在fuzz一些比较垃圾的样本时，可能会浪费比较多的时间，所以通过 -m 设置内存，还是会在一定程度上提高效率的。</p>
<h3 id="3-4-多台机器-fuzz"><a href="#3-4-多台机器-fuzz" class="headerlink" title="3.4 多台机器 fuzz"></a>3.4 多台机器 fuzz</h3><p><a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/fuzzing_in_depth.md#d-using-multiple-machines-for-fuzzing">参考文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="3-5-fuzz-的状态检查"><a href="#3-5-fuzz-的状态检查" class="headerlink" title="3.5 fuzz 的状态检查"></a>3.5 fuzz 的状态检查</h3><p>这个操作可以通过 afl-whatsup 来实现，命令如 <code>afl-whatsup -s out_png</code>，在多台机器中，需要等待同步之后在执行该命令，或者在每台机器上单独执行这个命令。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2024-09-24_22-53-06.png" alt="nipaste_2024-09-24_22-53-0"></p>
<p>同时还可以执行   <code>afl-plot out_png/default ./plot</code>，使用这条命令生成AFL的图表。</p>
<h3 id="3-6-停止和重新启动AFL模糊测试的运行"><a href="#3-6-停止和重新启动AFL模糊测试的运行" class="headerlink" title="3.6 停止和重新启动AFL模糊测试的运行"></a>3.6 停止和重新启动AFL模糊测试的运行</h3><p><strong>中断</strong>：<strong>Control-C</strong> 可以中断当前正在运行的<code>afl-fuzz</code>实例。</p>
<p><strong>重新启动</strong>：使用相同的命令行，但需要将<code>-i</code>目录替换为<code>-i -</code>，表示为上一次这表示从上一次的状态继续，<strong>另一种方法</strong>是设置环境变量 <code>AFL_AUTORESUME=1</code>，这将自动使<code>afl-fuzz</code>在启动时恢复到之前的状态，而不需要手动修改命令行。</p>
<p><strong>运行临时模糊测试实例</strong>：通过设置环境变量 <code>AFL_BENCH_JUST_ONE=1</code> 和 <code>AFL_FAST_CAL=1</code>，可以加快模糊测试的速度并使其只处理一个实例。命令如下：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -i newseeds -o out -S newseeds -- ./target</span><br><span class="line">-i newseeds：指定新的种子文件目录</span><br><span class="line">-o out：指定输出目录，用于存储模糊测试的结果</span><br><span class="line">-S newseeds：指定这个临时实例的名称</span><br><span class="line">-- ./target：表示要模糊测试的目标程序</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><strong>注意事项：</strong><code>--</code> 表示后面的 <code>./target</code> 是要模糊测试的目标程序，而不是选项或参数。这在处理目标程序的名称时特别重要，因为目标程序的名称可能与某些选项重名</p>
</blockquote>
<h3 id="3-7-检查覆盖率，以及提升覆盖率的一些思路"><a href="#3-7-检查覆盖率，以及提升覆盖率的一些思路" class="headerlink" title="3.7 检查覆盖率，以及提升覆盖率的一些思路"></a>3.7 检查覆盖率，以及提升覆盖率的一些思路</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-showmap -C -i out -o /dev/null -- ./target -params @@</span><br></pre></td></tr></table></figure></div>

<p>可以通过上面的命令来查看覆盖率覆盖信息，同时可以借助这些信息来想办法提升覆盖率，比如</p>
<ul>
<li><strong>检查覆盖的具体代码行</strong>：了解哪些代码行被触达，哪些未被触达，可以帮助你更好地评估测试效果。这些可以使用 afl-cov 来做到，</li>
<li><strong>针对未覆盖区域的操作</strong>：对于未覆盖的区域，可以找对应的样本来触发这些路径</li>
<li><strong>处理核心资源</strong>：<code>export AFL_NO_AFFINITY=1</code>：使模糊测试不绑定到特定核心。<code>export AFL_TRY_AFFINITY=1</code>：尝试绑定到某个核心。</li>
<li><strong>覆盖率的限制</strong>：可能输入示例只会涉及到部分 API</li>
</ul>
<h3 id="3-8-fuzz-的时间参考"><a href="#3-8-fuzz-的时间参考" class="headerlink" title="3.8 fuzz 的时间参考"></a>3.8 fuzz 的时间参考</h3><p>如果经过一天或者一周都没有出现新的路径，那么就可以认为不会出现新的crash之类的了，可以考虑换种思路。</p>
<h3 id="3-9-提升-fuzz-的速度"><a href="#3-9-提升-fuzz-的速度" class="headerlink" title="3.9 提升 fuzz 的速度"></a>3.9 提升 fuzz 的速度</h3><p><strong>使用持久模式</strong>：实现2到20倍的速度提升。</p>
<p><strong>设置环境变量</strong>：</p>
<ul>
<li>如果不使用共享内存持久模式，设置<code>AFL_TMPDIR</code>指向<code>tempfs</code>位置。</li>
</ul>
<p><strong>优化Linux内核</strong>：</p>
<ul>
<li><p>修改 <code>/etc/default/grub</code>，设置 <code>GRUB_CMDLINE_LINUX_DEFAULT</code>为：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibpb=off ibrs=off kpti=off l1tf=off mds=off mitigations=off no_stf_barrier noibpb noibrs nopcid nopti nospec_store_bypass_disable nospectre_v1 nospectre_v2 pcid=off pti=off spec_store_bypass_disable=off spectre_v2=off stf_barrier=off</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>更新grub并重启（注意：这会降低系统安全性）。</p>
</li>
</ul>
<p><strong>文件系统优化</strong>：</p>
<ul>
<li>在ext2文件系统上运行，并使用<code>noatime</code>挂载选项，以提高速度。</li>
</ul>
<p><strong>利用多核处理器</strong>：确保使用所有核心。</p>
<p><strong>首次启动前配置</strong>：在重启后运行<code>sudo afl-system-config</code>。</p>
<h3 id="3-10-发现-crash-之外的内容"><a href="#3-10-发现-crash-之外的内容" class="headerlink" title="3.10 发现 crash 之外的内容"></a>3.10 发现 crash 之外的内容</h3><p>暂时不太关心，<a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/fuzzing_in_depth.md#j-going-beyond-crashes">参考文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="4-Triaging-crashes"><a href="#4-Triaging-crashes" class="headerlink" title="4. Triaging crashes"></a>4. Triaging crashes</h2><p>基于覆盖率的崩溃分组通常会产生一个较小的数据集，可以通过手动方式或简单的GDB或Valgrind脚本快速分类</p>
<p><strong>崩溃探索模式（crash exploration mode）</strong>用于深入分析导致程序崩溃的输入，以帮助发现和理解崩溃背后的原因。具体用途包括：</p>
<ol>
<li><strong>代码路径枚举</strong>：该模式通过使用崩溃的测试用例，快速探索程序的所有可达代码路径，保持程序在崩溃状态。</li>
<li><strong>控制权分析</strong>：生成的结果集可以帮助分析攻击者对崩溃地址的控制程度，评估潜在的安全漏洞。</li>
<li><strong>提高利用率</strong>：通过识别不同的执行路径和可能的输入变异，帮助安全研究人员理解崩溃是否可被利用，并探索可能的利用方式。</li>
</ol>
<p>AFL++ 中的另一个工具是 afl-analyze 工具。它获取一个输入文件，尝试按顺序翻转字节并观察测试程序的行为。然后，<strong>它会根据哪些部分看起来是关键的、哪些部分不是关键的，对输入进行颜色编码</strong>，通常可以快速洞察复杂的文件格式。</p>
<p><code>casr-afl</code><a class="link" target="_blank" rel="noopener" href="https://github.com/ispras/casr">CASR <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>工具可轻松分类 AFL++ 发现的崩溃。报告是聚合的，包含严重性和其他信息。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">casr-afl -i /path/to/afl/out/dir -o /path/to/casr/out/dir</span><br></pre></td></tr></table></figure></div>







<h2 id="5-知识点总结"><a href="#5-知识点总结" class="headerlink" title="5. 知识点总结"></a>5. 知识点总结</h2><h3 id="5-1-afl-的模式和特性"><a href="#5-1-afl-的模式和特性" class="headerlink" title="5.1 afl 的模式和特性"></a>5.1 afl 的模式和特性</h3><p>AFL 中不同的模糊测试插桩模式及其特性</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">                                       |------------- FEATURES -------------|</span><br><span class="line">MODES:                                  NCC PERSIST DICT   LAF CMPLOG SELECT</span><br><span class="line">  [LLVM] LLVM:             AVAILABLE    [SELECTED]</span><br><span class="line">      PCGUARD              AVAILABLE    yes yes     module yes yes    yes</span><br><span class="line">      NATIVE               AVAILABLE    no  yes     no     no  part.  yes</span><br><span class="line">      CLASSIC              AVAILABLE    no  yes     module yes yes    yes</span><br><span class="line">        - NORMAL</span><br><span class="line">        - CALLER</span><br><span class="line">        - CTX</span><br><span class="line">        - NGRAM-{2-16}</span><br><span class="line">  [LTO] LLVM LTO:          unavailable!</span><br><span class="line">      PCGUARD              DEFAULT      yes yes     yes    yes yes    yes</span><br><span class="line">      CLASSIC                           yes yes     yes    yes yes    yes</span><br><span class="line">  [GCC_PLUGIN] gcc plugin: AVAILABLE</span><br><span class="line">      CLASSIC              DEFAULT      no  yes     no     no  no     yes</span><br><span class="line">  [GCC/CLANG] simple gcc/clang: AVAILABLE</span><br><span class="line">      CLASSIC              DEFAULT      no  no      no     no  no     no</span><br></pre></td></tr></table></figure></div>

<ol>
<li>关于 <code>MODES</code> 的子模式解释如下：</li>
</ol>
<p><strong>PCGUARD</strong>：</p>
<ul>
<li>描述：使用<strong>支配树插桩，性能最好</strong>，提供更精细的路径覆盖信息。</li>
<li>文档：详细信息可以在 <code>README.llvm.md</code> 中找到。</li>
</ul>
<p><strong>LLVM-NATIVE</strong>：</p>
<ul>
<li>描述：使用 LLVM 的本地 PCGUARD 插桩，<strong>性能较差</strong>，但与 LLVM 更好集成。</li>
</ul>
<p><strong>CLASSIC</strong>：</p>
<ul>
<li>描述：使用<strong>决策目标插桩</strong>，提供基本的路径覆盖信息。</li>
<li>文档：详细信息在 <code>README.llvm.md</code> 中。</li>
</ul>
<p><strong>CALLER</strong>：</p>
<ul>
<li>描述：在 CLASSIC 模式基础上增加单个被调用者上下文，提供更好的调用关系跟踪。</li>
<li>文档：更多细节在 <code>instrumentation/README.ctx.md</code> 中。</li>
</ul>
<p><strong>CTX</strong>：</p>
<ul>
<li>描述：在 CLASSIC 模式基础上增加完整的被调用者上下文，提供更全面的调用关系跟踪。</li>
<li>文档：详细信息在 <code>instrumentation/README.ctx.md</code> 中。</li>
</ul>
<p><strong>NGRAM-x</strong>：</p>
<ul>
<li>描述：在 CLASSIC 模式基础上，结合之前的路径信息，增强对路径的跟踪能力。</li>
</ul>
<ol start="2">
<li>关于<code>Features</code> 的说明如下：</li>
</ol>
<p>**NCC (Non-Colliding Coverage)**：</p>
<ul>
<li>描述：非冲突覆盖，可以自动避免重复路径的覆盖，提供更有效的路径探索。</li>
<li>文档：详见 <code>instrumentation/README.lto.md</code>。</li>
</ul>
<p>**PERSIST (Persistent Mode Support)**：</p>
<ul>
<li>描述：支持持久模式，显著提高运行速度，避免每次执行都重新初始化。</li>
<li>文档：详见 <code>instrumentation/README.persistent_mode.md</code>。</li>
</ul>
<p>**DICT (Dictionary in the Target)**：</p>
<ul>
<li>描述：目标程序中使用字典，可通过自动方式或 LLVM 模块传递支持。</li>
<li>文档：详见 <code>instrumentation/README.lto.md</code> 和 <code>instrumentation/README.llvm.md</code>。</li>
</ul>
<p>**LAF (Comparison Splitting)**：</p>
<ul>
<li>描述：比较分裂，可以增强输入的多样性，详细信息见文档。</li>
<li>文档：详见 <code>instrumentation/README.laf-intel.md</code>。</li>
</ul>
<p>**CMPLOG (Input to State Exploration)**：</p>
<ul>
<li>描述：探索输入与程序状态之间的关系，有助于更好地理解程序行为。</li>
<li>文档：详见 <code>instrumentation/README.cmplog.md</code>。</li>
</ul>
<p>**SELECT (Selective Instrumentation)**：</p>
<ul>
<li>描述：根据文件名或函数名选择性插桩，可以允许或拒绝特定的插桩。</li>
<li>文档：详见 <code>instrumentation/README.instrument_list.md</code>。</li>
</ul>
<h3 id="5-2-afl-相关环境变量"><a href="#5-2-afl-相关环境变量" class="headerlink" title="5.2 afl 相关环境变量"></a>5.2 afl 相关环境变量</h3><p><a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/env_variables.md">参考文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>一般环境变量</strong></p>
<blockquote>
<ol>
<li><strong>AFL_CC</strong>：指定要使用的 C 编译器的路径。</li>
<li><strong>AFL_CXX</strong>：指定要使用的 C++ 编译器的路径。</li>
<li><strong>AFL_DEBUG</strong>：启用开发者调试输出，便于排查问题。</li>
<li><strong>AFL_DONT_OPTIMIZE</strong>：禁用优化，通常用于调试，而不是使用默认的 <code>-O3</code> 优化选项。</li>
<li><strong>AFL_NO_BUILTIN</strong>：禁用字符串比较函数的内置版本（适用于 <code>libtokencap.so</code>）。</li>
<li><strong>AFL_NOOPT</strong>：使编译器表现得像一个普通编译器，以通过配置测试。</li>
<li><strong>AFL_PATH</strong>：指定插桩过程和运行时的路径（如 <code>afl-compiler-rt.*o</code>）。</li>
<li><strong>AFL_IGNORE_UNKNOWN_ENVS</strong>：忽略未知环境变量，不会显示警告。</li>
<li><strong>AFL_INST_RATIO</strong>：指定要插桩的分支百分比。</li>
<li><strong>AFL_QUIET</strong>：抑制详细输出，减少输出信息。</li>
<li><strong>AFL_HARDEN</strong>：增加代码硬化，以捕捉内存错误。</li>
<li><strong>AFL_USE_ASAN</strong>：激活地址 sanitizer（ASan），用于检测内存错误。</li>
<li><strong>AFL_USE_CFISAN</strong>：激活控制流 sanitizer（CFI San），用于检测控制流错误。</li>
<li><strong>AFL_USE_MSAN</strong>：激活内存 sanitizer（MSan），用于检测未初始化内存的使用。</li>
<li><strong>AFL_USE_UBSAN</strong>：激活未定义行为 sanitizer（UBSan），用于检测未定义行为。</li>
<li><strong>AFL_USE_TSAN</strong>：激活线程 sanitizer（TSan），用于检测线程相关问题。</li>
<li><strong>AFL_USE_LSAN</strong>：激活泄漏检查器（Leak Checker），用于检测内存泄漏。</li>
</ol>
</blockquote>
<p><strong>GCC 插件特定环境变量</strong></p>
<blockquote>
<ol>
<li><strong>AFL_GCC_CMPLOG</strong>：记录比较操作数（用于 RedQueen 变异器）。</li>
<li><strong>AFL_GCC_OUT_OF_LINE</strong>：禁用内联插桩。</li>
<li><strong>AFL_GCC_SKIP_NEVERZERO</strong>：在跟踪计数器上不跳过零。</li>
<li><strong>AFL_GCC_INSTRUMENT_FILE</strong>：根据文件名启用选择性插桩。</li>
</ol>
</blockquote>
<p><strong>LLVM/LTO/afl-clang-fast/afl-clang-lto 特定环境变量</strong></p>
<blockquote>
<ol>
<li><strong>AFL_LLVM_THREADSAFE_INST</strong>：使用线程安全计数器进行插桩，禁用 neverzero。</li>
<li><strong>AFL_LLVM_SKIP_NEVERZERO</strong>：在跟踪计数器上不跳过零。</li>
<li><strong>AFL_LLVM_DICT2FILE</strong>：基于找到的比较生成 AFL 字典。</li>
<li><strong>AFL_LLVM_DICT2FILE_NO_MAIN</strong>：跳过主函数的字典解析。</li>
<li><strong>AFL_LLVM_INJECTIONS_ALL</strong>：启用所有注入钩子。</li>
<li><strong>AFL_LLVM_INJECTIONS_SQL</strong>：启用 SQL 注入钩子。</li>
<li><strong>AFL_LLVM_INJECTIONS_LDAP</strong>：启用 LDAP 注入钩子。</li>
<li><strong>AFL_LLVM_INJECTIONS_XSS</strong>：启用 XSS 注入钩子。</li>
<li><strong>AFL_LLVM_LAF_ALL</strong>：启用所有 LAF 分裂/变换。</li>
<li><strong>AFL_LLVM_LAF_SPLIT_COMPARES</strong>：启用级联比较。</li>
<li><strong>AFL_LLVM_LAF_SPLIT_COMPARES_BITW</strong>：设置级联比较的大小限制（默认 8）。</li>
<li><strong>AFL_LLVM_LAF_SPLIT_SWITCHES</strong>：对开关进行级联比较。</li>
<li><strong>AFL_LLVM_LAF_SPLIT_FLOATS</strong>：对浮点数进行级联比较。</li>
<li><strong>AFL_LLVM_LAF_TRANSFORM_COMPARES</strong>：对字符串函数的比较进行级联。</li>
<li><strong>AFL_LLVM_ALLOWLIST/AFL_LLVM_DENYLIST</strong>：启用插桩的允许/拒绝列表（选择性插桩）。</li>
<li><strong>AFL_LLVM_CMPLOG</strong>：记录比较操作数（用于 RedQueen 变异器）。</li>
<li><strong>AFL_LLVM_INSTRUMENT</strong>：设置插桩模式，如 CLASSIC、PCGUARD、LTO、GCC、CLANG、CALLER、CTX、NGRAM-2..16。</li>
</ol>
</blockquote>
<p><strong>旧环境变量（兼容性）</strong></p>
<blockquote>
<ol>
<li><strong>AFL_LLVM_USE_TRACE_PC</strong>：使用 LLVM 的 trace-pc-guard 插桩。</li>
<li><strong>AFL_LLVM_CALLER</strong>：使用单一上下文敏感覆盖（用于 CLASSIC）。</li>
<li><strong>AFL_LLVM_CTX</strong>：使用完整的上下文敏感覆盖（用于 CLASSIC）。</li>
<li><strong>AFL_LLVM_NGRAM_SIZE</strong>：使用 ngram 先前位置计数覆盖（用于 CLASSIC）。</li>
<li><strong>AFL_LLVM_NO_RPATH</strong>：禁用自定义 LLVM 位置的 rpath 设置。</li>
</ol>
</blockquote>
<h3 id="5-3-persistent-mode"><a href="#5-3-persistent-mode" class="headerlink" title="5.3 persistent mode"></a>5.3 persistent mode</h3><p>关于持久模式（persistent mode）的说明文档见<a class="link" target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/instrumentation/README.persistent_mode.md">这里 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，简单翻译如下</p>
<blockquote>
<p>在持久模式下，AFL++ 在单个进程中多次模糊测试目标，而不是每次执行模糊测试时都fork一个新进程。这是最有效的模糊测试方法，因为速度可以轻松提高 10 倍或 20 倍，且没有任何缺点。<em>所有专业模糊测试都使用此模式。</em></p>
<p>持久模式要求目标可以在一个或多个函数中调用，并且其状态可以完全重置，以便可以执行多次调用而不会发生资源泄漏，并且之前的运行不会对将来的运行产生影响。</p>
</blockquote>
<p>举一个例子就是</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"what_you_need_for_your_target.h"</span></span></span><br><span class="line"></span><br><span class="line">__AFL_FUZZ_INIT();</span><br><span class="line"></span><br><span class="line">main() {</span><br><span class="line"></span><br><span class="line">  <span class="comment">// anything else here, e.g. command line arguments, initialization, etc.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __AFL_HAVE_MANUAL_CONTROL</span></span><br><span class="line">  __AFL_INIT();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> *buf = __AFL_FUZZ_TESTCASE_BUF;  <span class="comment">// must be after __AFL_INIT</span></span><br><span class="line">                                                 <span class="comment">// and before __AFL_LOOP!</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (__AFL_LOOP(<span class="number">10000</span>)) {</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = __AFL_FUZZ_TESTCASE_LEN;  <span class="comment">// don't use the macro directly in a</span></span><br><span class="line">                                        <span class="comment">// call!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len &lt; <span class="number">8</span>) <span class="keyword">continue</span>;  <span class="comment">// check for a required/useful minimum input length</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Setup function call, e.g. struct target *tmp = libtarget_init() */</span></span><br><span class="line">    <span class="comment">/* Call function to be fuzzed, e.g.: */</span></span><br><span class="line">    target_function(buf, len);</span><br><span class="line">    <span class="comment">/* Reset state. e.g. libtarget_free(tmp) */</span></span><br><span class="line"></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p>原本我们可能需要通过标准输入或者文件输入将内容输入到 buf 中，然后调用 <code>target_function</code>，实际上这样的情况下，每一次这样的过程都是需要一次 fork 系统调用，这增加了内核的开销，所以我们通过设置 <code>__AFL_LOOP(10000)</code>，可以在保证单个进程持续对目标进行 fuzz，而且会自动更新 buf 的内容。</p>
<p>上面部分宏定义参考如下（以下宏定义能够在没有 afl-clang-fast/lto 的情况下编译目标）：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __AFL_FUZZ_TESTCASE_LEN</span></span><br><span class="line">  <span class="type">ssize_t</span> fuzz_len;</span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> __AFL_FUZZ_TESTCASE_LEN fuzz_len</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> fuzz_buf[<span class="number">1024000</span>];</span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> __AFL_FUZZ_TESTCASE_BUF fuzz_buf</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> __AFL_FUZZ_INIT() void sync(void);</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> __AFL_LOOP(x) ((fuzz_len = read(0, fuzz_buf, sizeof(fuzz_buf))) &gt; 0 ? 1 : 0)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> __AFL_INIT() sync()</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></div>



<p><strong>Deferred initialization</strong></p>
<p>AFL++ 通过确保目标程序只执行一次（在main函数之前停下来，然后克隆当前进程对目标fuzz）来优化性能，这在一定程度上确实优化了性能，但是程序中往往还会存在其他比较耗时性的操作，如在 main 函数开始处解析一个大型的配置文件，那实际上每个fork出来的每个进程又要花时间去解析这些文件，这在一定程度上是非常耗时的，所以说延迟初始化的作用就体现出了。</p>
<p><strong>注意事项：</strong>延迟初始化的位置如果选择的不对，可能会让程序出现故障，如下就是一些可能出现故障的例子：</p>
<ul>
<li>创建任何重要的线程或子进程 - 因为 forkserver 无法轻易克隆它们。</li>
<li><code>setitimer()</code>通过或等效调用来初始化计时器。</li>
<li>创建临时文件、网络套接字、偏移敏感文件描述符以及类似的共享状态资源 - 但前提是它们的状态对程序以后的行为有显著影响。</li>
<li>对模糊输入的任何访问，包括读取有关其大小的元数据</li>
</ul>
<p>选择位置后，在适当的位置添加以下代码：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#ifdef __AFL_HAVE_MANUAL_CONTROL</span><br><span class="line">  __AFL_INIT();</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></div>

<p>这里使用 <code>#ifdef</code> 进行保护，但包含它们可确保程序在使用 afl-clang-fast/afl-clang-lto/afl-gcc-fast 以外的工具编译时继续正常工作。</p>
<p><strong>Persistent mode</strong></p>
<p>该操作的基本结构如下：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (__AFL_LOOP(<span class="number">1000</span>)) {</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Read input data. */</span></span><br><span class="line">  <span class="comment">/* Call library code to be fuzzed. */</span></span><br><span class="line">  <span class="comment">/* Reset state. */</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Exit normally. */</span></span><br></pre></td></tr></table></figure></div>

<p>为什么说这个循环里面一般会放一些无状态的 API 呢，或者怎么理解这个无状态，简单理解就是，这里的操作不会影响后续的一些操作，可以一直重置状态。这里的重置状态就是我们每次 <code>call func </code>结束之后，可以立马更新数据，进入到下一次同样的操作中，下面的指令就是一个例子。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (__AFL_LOOP(<span class="number">1000</span>)) {</span><br><span class="line">    <span class="type">int</span> len = __AFL_FUZZ_TESTCASE_LEN;</span><br><span class="line">    xmlDocPtr doc = xmlReadMemory((<span class="type">char</span> *)buf, len, <span class="string">"https://mykter.com"</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (doc != <span class="literal">NULL</span>) {</span><br><span class="line">        xmlFreeDoc(doc);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>



<p><strong>Shared memory fuzzing</strong></p>
<p>通过共享内存的方式又可以极大的提高 fuzz 的效率，这一点理解上不难，简单来说省去了每一次过程中分配内存</p>
<p>，释放内存等耗时操作，具体使用如下。</p>
<p>在 <code>#include</code> 指令之后，main 函数之前可以设置下面的命令。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__AFL_FUZZ_INIT();</span><br></pre></td></tr></table></figure></div>

<p>设置共享内存，放在 <code>__AFL_LOOP</code> 之前</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unsigned char *buf = __AFL_FUZZ_TESTCASE_BUF;</span><br></pre></td></tr></table></figure></div>

<p>下面这个命令放在<code>__AFL_LOOP</code> 循环的第一行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int len = __AFL_FUZZ_TESTCASE_LEN;</span><br></pre></td></tr></table></figure></div>



<h3 id="5-4-afl-fuzz-参数解析"><a href="#5-4-afl-fuzz-参数解析" class="headerlink" title="5.4 afl-fuzz 参数解析"></a>5.4 afl-fuzz 参数解析</h3><p><strong>必需参数</strong></p>
<ul>
<li><strong>-i dir</strong>：指定包含测试用例的输入目录。可以使用 <code>-</code> 来恢复上次的模糊测试（查看 AFL_AUTORESUME）。</li>
<li><strong>-o dir</strong>：指定用于存储模糊测试发现的输出目录。</li>
</ul>
<p><strong>执行控制设置</strong></p>
<ul>
<li><strong>-P strategy</strong>：设置固定的变异策略：<ul>
<li><code>explore</code>（专注于新的覆盖路径）</li>
<li><code>exploit</code>（专注于触发崩溃）</li>
<li>你还可以设置在没有新发现后切换到 <code>exploit</code> 模式的时间（默认 1000 秒）。</li>
</ul>
</li>
<li><strong>-p schedule</strong>：指定功率调度计算种子的性能得分，选项包括：<ul>
<li><code>explore</code>（默认）</li>
<li><code>fast</code></li>
<li><code>exploit</code></li>
<li><code>seek</code></li>
<li><code>rare</code></li>
<li><code>mmopt</code></li>
<li><code>coe</code></li>
<li><code>lin</code></li>
<li><code>quad</code></li>
</ul>
</li>
<li><strong>-f file</strong>：指定模糊程序读取的位置（默认为 <code>stdin</code> 或 <code>@@</code>）。</li>
<li><strong>-t msec</strong>：为每次运行设置超时（自动缩放，默认为 1000 毫秒）。在值后加 <code>+</code> 可自动计算超时，值为最大值。</li>
<li><strong>-m megs</strong>：为子进程设置内存限制（以 MB 为单位，0 表示无限制，默认为 0）。</li>
<li><strong>-O</strong>：使用仅二进制插桩（FRIDA 模式）。</li>
<li><strong>-Q</strong>：使用仅二进制插桩（QEMU 模式）。</li>
<li><strong>-U</strong>：使用基于 Unicorn 的插桩（Unicorn 模式）。</li>
<li><strong>-W</strong>：使用带 Wine 的 QEMU 模式进行插桩。</li>
<li><strong>-X</strong>：使用 VM 模糊测试（NYX 模式 - 独立模式）。</li>
<li><strong>-Y</strong>：使用 VM 模糊测试（NYX 模式 - 多实例模式）。</li>
</ul>
<p><strong>变异器设置</strong></p>
<ul>
<li><strong>-a type</strong>：指定目标输入格式，选择 <code>"text"</code> 或 <code>"binary"</code>（默认是 <code>generic</code>）。</li>
<li><strong>-g minlength</strong>：设置生成的模糊输入的最小长度（默认 1）。</li>
<li><strong>-G maxlength</strong>：设置生成的模糊输入的最大长度（默认 1048576）。</li>
<li><strong>-L minutes</strong>：使用 MOpt（优化模式），并设置进入节拍模式的时间限制（无新发现的分钟数）。0 表示立即，-1 表示立即并结合正常变异。</li>
<li><strong>-c program</strong>：通过指定为 CmpLog 编译的二进制文件来启用 CmpLog。如果使用 QEMU/FRIDA 或模糊目标为 CmpLog 编译，则使用 <code>-c 0</code>。要禁用 CmpLog，请使用 <code>-c -</code>。</li>
<li><strong>-l cmplog_opts</strong>：CmpLog 配置值（例如 <code>"2ATR"</code>）：<ul>
<li><code>1</code> = 小文件</li>
<li><code>2</code> = 大文件（默认）</li>
<li><code>3</code> = 所有文件</li>
<li><code>A</code> = 算术求解</li>
<li><code>T</code> = 转换求解</li>
<li><code>X</code> = 极端转换求解</li>
<li><code>R</code> = 随机颜色化字节。</li>
</ul>
</li>
</ul>
<p><strong>模糊测试行为设置</strong></p>
<ul>
<li><strong>-Z</strong>：使用顺序队列选择，而不是加权随机。</li>
<li><strong>-N</strong>：不删除模糊输入文件（适用于设备等）。</li>
<li><strong>-n</strong>：无插桩模糊测试（非插桩模式）。</li>
<li><strong>-x dict_file</strong>：指定模糊字典（参见 README.md，可以指定最多 4 次）。</li>
</ul>
<p><strong>测试设置</strong></p>
<ul>
<li><strong>-s seed</strong>：使用固定的随机数生成器种子。</li>
<li><strong>-V seconds</strong>：模糊测试指定时间后终止（仅模糊时间）。</li>
<li><strong>-E execs</strong>：在大约指定的总执行次数后终止模糊测试（注意：不精确，可能会有额外的执行）。</li>
</ul>
<p><strong>其他设置</strong></p>
<ul>
<li><strong>-M/-S id</strong>：分布式模式（-M 设置 -Z 并禁用修剪）。<ul>
<li>参见 docs/fuzzing_in_depth.md#c-using-multiple-cores 以获取有效的并行模糊测试建议。</li>
</ul>
</li>
<li><strong>-F path</strong>：同步到外部模糊测试队列目录（需要 -M，最多可以指定 32 次）。</li>
<li><strong>-z</strong>：跳过增强的确定性模糊测试（注意旧的 -d 和 -D 标志被忽略）。</li>
<li><strong>-T text</strong>：在屏幕上显示的文本横幅。</li>
<li><strong>-I command</strong>：当发现新崩溃时执行此命令/脚本。</li>
<li><strong>-C</strong>：崩溃探索模式（“秘鲁兔子”模式）。</li>
<li><strong>-b cpu_id</strong>：将模糊测试进程绑定到指定的 CPU 核心（0 及以上）。</li>
<li><strong>-e ext</strong>：模糊测试输入文件的文件扩展名（如有需要）。</li>
</ul>
<h3 id="CFLAGS-”-fsanitize-address”"><a href="#CFLAGS-”-fsanitize-address”" class="headerlink" title="CFLAGS=”-fsanitize=address”"></a>CFLAGS=”-fsanitize=address”</h3>
        </div>

        
            <div class="post-copyright-info my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> AFL 使用技巧总结</li>
        <li><strong>Author:</strong> henry</li>
        <li><strong>Created at
                :</strong> 2024-09-29 10:29:32</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-09-29 10:39:27
            </li>
        
        <li>
            <strong>Link:</strong> https://henrymartin262.github.io/2024/09/29/AFL使用技巧总结/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/AFL/">#AFL++</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/09/30/UBFuzz/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">看论文 UBfuzz Finding Bugs in Sanitizer Implementations</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/09/29/KLEE_note/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">KLEE 学习笔记</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container pjax">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          requiredMeta: ['nick', 'mail']
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">AFL 使用技巧总结</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#AFL-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93"><span class="nav-text">AFL 使用技巧总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B"><span class="nav-text">快速简易上手</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95"><span class="nav-text">源码模糊测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Instrument-target"><span class="nav-text">Instrument target</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Preparing-the-fuzzing-campaign"><span class="nav-text">Preparing the fuzzing campaign</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing-the-target"><span class="nav-text">Fuzzing the target</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Managing-the-fuzzing-campaign"><span class="nav-text">Managing the fuzzing campaign</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-fuzzing-in-depth"><span class="nav-text">2. fuzzing in depth</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Instrumenting-the-target"><span class="nav-text">2.1 Instrumenting the target</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Preparing-the-fuzzing-campaign"><span class="nav-text">2.2 Preparing the fuzzing campaign</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Fuzzing-the-target"><span class="nav-text">3. Fuzzing the target</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%8A%A0%E5%BF%AB%E6%89%A7%E8%A1%8C%E9%80%9F%E5%BA%A6"><span class="nav-text">3.1 加快执行速度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%BF%85%E8%A6%81%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%AD%97%E5%85%B8"><span class="nav-text">3.2 必要时添加字典</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E6%8E%A7%E5%88%B6%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E5%92%8C%E8%B6%85%E6%97%B6"><span class="nav-text">3.3 控制内存使用和超时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%A4%9A%E5%8F%B0%E6%9C%BA%E5%99%A8-fuzz"><span class="nav-text">3.4 多台机器 fuzz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-fuzz-%E7%9A%84%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="nav-text">3.5 fuzz 的状态检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E5%81%9C%E6%AD%A2%E5%92%8C%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8AFL%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="nav-text">3.6 停止和重新启动AFL模糊测试的运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-%E6%A3%80%E6%9F%A5%E8%A6%86%E7%9B%96%E7%8E%87%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%8F%90%E5%8D%87%E8%A6%86%E7%9B%96%E7%8E%87%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF"><span class="nav-text">3.7 检查覆盖率，以及提升覆盖率的一些思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-fuzz-%E7%9A%84%E6%97%B6%E9%97%B4%E5%8F%82%E8%80%83"><span class="nav-text">3.8 fuzz 的时间参考</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-%E6%8F%90%E5%8D%87-fuzz-%E7%9A%84%E9%80%9F%E5%BA%A6"><span class="nav-text">3.9 提升 fuzz 的速度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-%E5%8F%91%E7%8E%B0-crash-%E4%B9%8B%E5%A4%96%E7%9A%84%E5%86%85%E5%AE%B9"><span class="nav-text">3.10 发现 crash 之外的内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Triaging-crashes"><span class="nav-text">4. Triaging crashes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93"><span class="nav-text">5. 知识点总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-afl-%E7%9A%84%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%89%B9%E6%80%A7"><span class="nav-text">5.1 afl 的模式和特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-afl-%E7%9B%B8%E5%85%B3%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">5.2 afl 相关环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-persistent-mode"><span class="nav-text">5.3 persistent mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-afl-fuzz-%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="nav-text">5.4 afl-fuzz 参数解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CFLAGS-%E2%80%9D-fsanitize-address%E2%80%9D"><span class="nav-text">CFLAGS&#x3D;”-fsanitize&#x3D;address”</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">henry</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.6</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


    <div id="aplayer"></div>

<script src="/js/libs/APlayer.min.js"></script>


<script src="/js/plugins/aplayer.js"></script>


</body>
</html>
